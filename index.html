<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý chi phí</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.08);
            border: none;
            margin-bottom: 25px;
        }
        .card-header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 20px;
            font-weight: 600;
            font-size: 1.4rem;
        }
        .table th {
            background-color: #e9ecef;
            border-top: none;
            font-weight: 600;
            color: #495057;
        }
        .btn-custom {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }
        .modal-header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }
        .badge-success {
            background-color: #28a745;
            padding: 8px 12px;
            border-radius: 20px;
        }
        .total-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #6a11cb;
            margin-top: 20px;
        }
        .icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        .detail-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .detail-label {
            font-weight: 600;
            color: #555;
        }
        .detail-value {
            color: #333;
            font-weight: 500;
        }
        .money {
            color: #28a745;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <div>
                                <h4 class="mb-0">QUẢN LÝ CHI PHÍ CÔNG VIỆC</h4>
                                <p class="mb-0 opacity-75">Theo dõi và phân bổ chi phí theo thành viên</p>
                            </div>
                        </div>
                        <button class="btn btn-light" onclick="exportToExcel()">
                            <i class="fas fa-file-excel me-2"></i>Xuất Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-table me-2"></i>CHI TIẾT CÁC KHOẢN CHI
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="expenseTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>ID</th>
                                        <th>Ngày</th>
                                        <th>Nội dung</th>
                                        <th>Phí vật tư</th>
                                        <th>Tiền công</th>
                                        <th>Triều</th>
                                        <th>Tèo</th>
                                        <th>Thiện</th>
                                        <th>Thuận</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Tổng chi phí -->
                        <div class="total-section">
                            <div class="row">
                                <div class="col-md-3 col-6 mb-3">
                                    <h6>Tổng chi vật tư</h6>
                                    <h4 class="money" id="totalMaterial">0 đ</h4>
                                </div>
                                <div class="col-md-3 col-6 mb-3">
                                    <h6>Tổng tiền công</h6>
                                    <h4 class="money" id="totalWage">0 đ</h4>
                                </div>
                                <div class="col-md-3 col-6 mb-3">
                                    <h6>Tổng chi phí</h6>
                                    <h4 class="money" id="totalAll">0 đ</h4>
                                </div>
                                <div class="col-md-3 col-6 mb-3">
                                    <h6>Số khoản chi</h6>
                                    <h4 id="totalCount">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Chi tiết -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailModalLabel"><i class="fas fa-info-circle me-2"></i>CHI TIẾT KHOẢN CHI</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="detail-item">
                                <span class="detail-label">ID:</span>
                                <span class="detail-value" id="detailId">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ngày:</span>
                                <span class="detail-value" id="detailDate">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Nội dung:</span>
                                <span class="detail-value" id="detailContent">-</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <span class="detail-label">Phí vật tư:</span>
                                <span class="detail-value money" id="detailMaterial">0 đ</span>
                            </div>
                            <div class="detail-item">
                                <!-- ĐÃ SỬA: Định dạng số với dấu phân cách hàng nghìn -->
                                <span class="detail-label">Tiền công:</span>
                                <span class="detail-value money" id="detailWage">0 đ</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Tổng chi phí:</span>
                                <span class="detail-value money" id="detailTotal">0 đ</span>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <h6 class="mb-3"><i class="fas fa-users me-2"></i>Phân bổ chi phí</h6>
                    <div class="row">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <h6 class="mb-1">Triều</h6>
                                <h5 class="money mb-0" id="detailTrieu">0 đ</h5>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <h6 class="mb-1">Tèo</h6>
                                <h5 class="money mb-0" id="detailTeo">0 đ</h5>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <h6 class="mb-1">Thiện</h6>
                                <h5 class="money mb-0" id="detailThien">0 đ</h5>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <h6 class="mb-1">Thuận</h6>
                                <h5 class="money mb-0" id="detailThuan">0 đ</h5>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-custom" onclick="editItem()">
                        <i class="fas fa-edit me-2"></i>Sửa
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS & Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Excel export library -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <script>
        // Dữ liệu mẫu (đã sửa: lưu dưới dạng số nguyên, không có "đ" và thêm dòng thứ 3 từ ảnh)
        const data = [
            { 
                id: "001", 
                date: "06/06/2025", 
                content: "xít thuoc sau", 
                material: 0, 
                wage: 300000,  // 300.000 đ
                Trieu: 200000,  // 200.000 đ
                Teo: 100000,    // 100.000 đ
                Thien: 0, 
                Thuan: 0 
            },
            { 
                id: "002", 
                date: "06/06/2025", 
                content: "sua moter bom nuoc xít thuoc", 
                material: 0, 
                wage: 550000,  // 550.000 đ
                Trieu: 0, 
                Teo: 0, 
                Thien: 0, 
                Thuan: 550000   // 550.000 đ
            },
            { 
                id: "003", 
                date: "16/06/2025", 
                content: "mau 1 chay hopyang nha ty", 
                material: 140000,  // 140.000 đ
                wage: 0, 
                Trieu: 0, 
                Teo: 0, 
                Thien: 0, 
                Thuan: 0 
            }
        ];

        // Hàm định dạng số tiền với dấu phân cách hàng nghìn
        function formatMoney(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") + " đ";
        }

        // Hiển thị dữ liệu vào bảng
        function renderTable() {
            const tbody = document.querySelector('#expenseTable tbody');
            tbody.innerHTML = '';
            
            let totalMaterial = 0;
            let totalWage = 0;
            let totalAll = 0;
            
            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.id}</td>
                    <td>${item.date}</td>
                    <td>${item.content}</td>
                    <td class="money">${formatMoney(item.material)}</td>
                    <!-- ĐÃ SỬA: Hiển thị tiền công với định dạng số có dấu phân cách -->
                    <td class="money">${formatMoney(item.wage)}</td>
                    <td class="money">${formatMoney(item.Trieu)}</td>
                    <td class="money">${formatMoney(item.Teo)}</td>
                    <td class="money">${formatMoney(item.Thien)}</td>
                    <td class="money">${formatMoney(item.Thuan)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewDetail('${item.id}')">
                            <i class="fas fa-eye"></i> Xem
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
                
                totalMaterial += item.material;
                totalWage += item.wage;
                totalAll += item.material + item.wage;
            });
            
            // Cập nhật tổng
            document.getElementById('totalMaterial').textContent = formatMoney(totalMaterial);
            document.getElementById('totalWage').textContent = formatMoney(totalWage);
            document.getElementById('totalAll').textContent = formatMoney(totalAll);
            document.getElementById('totalCount').textContent = data.length;
        }

        // Xem chi tiết khoản chi
        function viewDetail(id) {
            const item = data.find(d => d.id === id);
            if (!item) return;
            
            // Điền thông tin vào modal
            document.getElementById('detailId').textContent = item.id;
            document.getElementById('detailDate').textContent = item.date;
            document.getElementById('detailContent').textContent = item.content;
            
            // ĐÃ SỬA: Định dạng tiền công với dấu phân cách hàng nghìn
            document.getElementById('detailMaterial').textContent = formatMoney(item.material);
            document.getElementById('detailWage').textContent = formatMoney(item.wage);
            
            // Tính tổng chi phí
            const totalCost = item.material + item.wage;
            document.getElementById('detailTotal').textContent = formatMoney(totalCost);
            
            // Phân bổ chi phí
            document.getElementById('detailTrieu').textContent = formatMoney(item.Trieu);
            document.getElementById('detailTeo').textContent = formatMoney(item.Teo);
            document.getElementById('detailThien').textContent = formatMoney(item.Thien);
            document.getElementById('detailThuan').textContent = formatMoney(item.Thuan);
            
            // Hiển thị modal
            const modal = new bootstrap.Modal(document.getElementById('detailModal'));
            modal.show();
        }

        // Xuất file Excel
        function exportToExcel() {
            const wsData = [
                ["#", "ID", "Ngày", "Nội dung", "Phí vật tư", "Tiền công", "Triều", "Tèo", "Thiện", "Thuận"]
            ];
            
            data.forEach((item, index) => {
                wsData.push([
                    index + 1,
                    item.id,
                    item.date,
                    item.content,
                    formatMoney(item.material),
                    formatMoney(item.wage), // Đã định dạng
                    formatMoney(item.Trieu),
                    formatMoney(item.Teo),
                    formatMoney(item.Thien),
                    formatMoney(item.Thuan)
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Chi tiết chi phí");
            
            // Xuất file
            XLSX.writeFile(wb, "Chi_tiet_chi_phi.xlsx");
        }

        // Hàm sửa khoản chi (chưa triển khai đầy đủ)
        function editItem() {
            alert("Chức năng sửa đang được phát triển!");
        }

        // Khởi tạo khi trang tải xong
        document.addEventListener('DOMContentLoaded', function() {
            renderTable();
        });
    </script>
</body>
</html>
