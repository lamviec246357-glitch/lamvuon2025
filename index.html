<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Chi Ph√≠ SR2526</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .main-container { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .stat-card h3 { font-size: 2rem; margin: 0; }
        .stat-card p { margin: 5px 0 0 0; font-size: 0.9rem; opacity: 0.9; }
        .chart-box { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        table { font-size: 0.9rem; }
        .table thead { background: #667eea; color: white; }
        .action-btn { padding: 5px 10px; margin: 0 2px; }
        .money { text-align: right; font-weight: bold; }
        .alert-custom { background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">
    <div class="main-container">
        <!-- Header -->
        <div class="text-center mb-4">
            <h2><i class="fas fa-leaf text-success"></i> Qu·∫£n L√Ω Chi Ph√≠ SR2526</h2>
            <p class="text-muted">H·ªá th·ªëng qu·∫£n l√Ω v√† theo d√µi chi ph√≠ t·ª± ƒë·ªông</p>
        </div>

        <!-- H∆∞·ªõng d·∫´n c·∫•u h√¨nh -->
        <div class="alert-custom" id="setupGuide">
            <h5><i class="fas fa-exclamation-triangle text-warning"></i> C·∫ßn c·∫•u h√¨nh l·∫ßn ƒë·∫ßu</h5>
            <p>ƒê·ªÉ s·ª≠ d·ª•ng h·ªá th·ªëng, b·∫°n c·∫ßn:</p>
            <ol>
                <li>C√≥ Google Sheets ID: <code>1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4</code></li>
                <li>Sheet ph·∫£i ƒë∆∞·ª£c public (Anyone with link can view)</li>
                <li>Ho·∫∑c s·ª≠ d·ª•ng Google Apps Script (xem h∆∞·ªõng d·∫´n b√™n d∆∞·ªõi)</li>
            </ol>
            <button class="btn btn-primary" onclick="showSetupModal()">üìñ Xem h∆∞·ªõng d·∫´n chi ti·∫øt</button>
            <button class="btn btn-success" onclick="loadSampleData()">üéØ D√πng d·ªØ li·ªáu m·∫´u</button>
        </div>

        <!-- Th·ªëng k√™ -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <h3 id="tTotal">0ƒë</h3>
                    <p>T·ªîNG CHI PH√ç</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3 id="tVatTu">0ƒë</h3>
                    <p>TI·ªÄN V·∫¨T T∆Ø</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3 id="tTienCong">0ƒë</h3>
                    <p>TI·ªÄN C√îNG</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <h3 id="totalRows">0</h3>
                    <p>S·ªê B√ÅN GHI</p>
                </div>
            </div>
        </div>

        <!-- Bi·ªÉu ƒë·ªì -->
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <div class="chart-box">
                    <h6 class="text-center mb-3">T·ª∑ l·ªá chi ph√≠</h6>
                    <canvas id="costChart" height="200"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-box">
                    <h6 class="text-center mb-3">L∆∞∆°ng nh√¢n vi√™n</h6>
                    <canvas id="staffChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- B·∫£ng d·ªØ li·ªáu -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0"><i class="fas fa-table text-primary"></i> Nh·∫≠t k√Ω chi ph√≠</h6>
                    <button class="btn btn-success btn-sm" onclick="alert('Ch·ª©c nƒÉng th√™m m·ªõi ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn')">
                        <i class="fas fa-plus"></i> Th√™m m·ªõi
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tbl" class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ng√†y</th>
                                <th>N·ªôi dung</th>
                                <th class="money">V·∫≠t t∆∞</th>
                                <th class="money">C√¥ng</th>
                                <th>Ghi ch√∫</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal h∆∞·ªõng d·∫´n -->
<div class="modal fade" id="setupModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">üìñ H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t ƒë·∫ßy ƒë·ªß</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>üéØ Ph∆∞∆°ng √°n 1: Ch·ªâ xem d·ªØ li·ªáu (ƒê∆°n gi·∫£n)</h6>
                <ol>
                    <li>M·ªü Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4" target="_blank">Link Sheet</a></li>
                    <li>File > Share > Change to "Anyone with the link"</li>
                    <li>File > Publish to web > Publish</li>
                    <li>Reload trang n√†y</li>
                </ol>

                <hr>

                <h6>üöÄ Ph∆∞∆°ng √°n 2: ƒê·∫ßy ƒë·ªß ch·ª©c nƒÉng (Th√™m/S·ª≠a/X√≥a + Email)</h6>
                <ol>
                    <li><b>T·∫°o Google Apps Script:</b>
                        <ul>
                            <li>V√†o <a href="https://script.google.com" target="_blank">script.google.com</a></li>
                            <li>New Project > Paste code t·ª´ file <code>Code.gs</code></li>
                            <li>Save (Ctrl+S)</li>
                        </ul>
                    </li>
                    <li><b>Deploy Web App:</b>
                        <ul>
                            <li>Deploy > New deployment</li>
                            <li>Type: Web app</li>
                            <li>Execute as: Me</li>
                            <li>Who has access: <b>Anyone</b></li>
                            <li>Deploy > Authorize > Allow</li>
                        </ul>
                    </li>
                    <li><b>Copy URL v√† c·∫≠p nh·∫≠t:</b>
                        <ul>
                            <li>Copy Web app URL</li>
                            <li>M·ªü file index.html</li>
                            <li>T√¨m d√≤ng: <code>const APPS_SCRIPT_URL = '...'</code></li>
                            <li>Thay b·∫±ng URL v·ª´a copy</li>
                            <li>Commit & push l√™n GitHub</li>
                        </ul>
                    </li>
                </ol>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <b>L∆∞u √Ω:</b> Trang n√†y hi·ªán ƒëang d√πng d·ªØ li·ªáu m·∫´u. ƒê·ªÉ k·∫øt n·ªëi th·∫≠t, c·∫ßn l√†m theo h∆∞·ªõng d·∫´n tr√™n.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                <a href="https://docs.google.com/spreadsheets/d/1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4" target="_blank" class="btn btn-primary">M·ªü Google Sheet</a>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
// C·∫•u h√¨nh
const SHEET_ID = '1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4';
const SHEET_NAME = 'SR2526';

// Bi·∫øn to√†n c·ª•c
var currentData = [];
var costChart = null;
var staffChart = null;

// H√†m helper
function money(n) {
    return Number(n).toLocaleString("vi-VN") + 'ƒë';
}

// Load d·ªØ li·ªáu m·∫´u
function loadSampleData() {
    currentData = [
        [1, '01/01/2024', 'Mua ph√¢n b√≥n', 500000, 300000, 'Ph√¢n NPK', 150000, 150000, 0, 0],
        [2, '02/01/2024', 'Thu√™ m√°y c√†y', 0, 1000000, '2 ng√†y', 500000, 500000, 0, 0],
        [3, '03/01/2024', 'Mua c√¢y gi·ªëng', 800000, 200000, '100 c√¢y', 100000, 100000, 0, 0],
        [4, '05/01/2024', 'L√†m c·ªè', 0, 600000, '', 200000, 200000, 200000, 0],
        [5, '08/01/2024', 'T∆∞·ªõi ti√™u', 300000, 400000, 'ƒêi·ªán n∆∞·ªõc', 100000, 100000, 100000, 100000]
    ];
    
    $('#setupGuide').hide();
    updateUI();
}

// C·∫≠p nh·∫≠t giao di·ªán
function updateUI() {
    // T√≠nh t·ªïng
    var totalVatTu = 0, totalTienCong = 0;
    var trieu = 0, teo = 0, thien = 0, thuan = 0;
    
    currentData.forEach(function(row) {
        totalVatTu += row[3] || 0;
        totalTienCong += row[4] || 0;
        trieu += row[6] || 0;
        teo += row[7] || 0;
        thien += row[8] || 0;
        thuan += row[9] || 0;
    });
    
    var total = totalVatTu + totalTienCong;
    
    // Hi·ªÉn th·ªã
    $('#tTotal').text(money(total));
    $('#tVatTu').text(money(totalVatTu));
    $('#tTienCong').text(money(totalTienCong));
    $('#totalRows').text(currentData.length);
    
    // B·∫£ng
    var html = '';
    currentData.forEach(function(row) {
        html += '<tr>';
        html += '<td>' + row[0] + '</td>';
        html += '<td>' + row[1] + '</td>';
        html += '<td>' + row[2] + '</td>';
        html += '<td class="money">' + money(row[3]) + '</td>';
        html += '<td class="money">' + money(row[4]) + '</td>';
        html += '<td>' + (row[5] || '') + '</td>';
        html += '</tr>';
    });
    
    if ($.fn.DataTable.isDataTable('#tbl')) {
        $('#tbl').DataTable().destroy();
    }
    
    $('#tbl tbody').html(html);
    $('#tbl').DataTable({
        language: { url: '//cdn.datatables.net/plug-ins/1.13.8/i18n/vi.json' },
        pageLength: 10
    });
    
    // Bi·ªÉu ƒë·ªì
    renderCharts(totalVatTu, totalTienCong, trieu, teo, thien, thuan);
}

// V·∫Ω bi·ªÉu ƒë·ªì
function renderCharts(vatTu, tienCong, trieu, teo, thien, thuan) {
    // Chart 1: Chi ph√≠
    var ctx1 = document.getElementById('costChart');
    if (costChart) costChart.destroy();
    
    costChart = new Chart(ctx1, {
        type: 'doughnut',
        data: {
            labels: ['V·∫≠t t∆∞', 'Ti·ªÅn c√¥ng'],
            datasets: [{
                data: [vatTu, tienCong],
                backgroundColor: ['#36A2EB', '#FF6384']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
    
    // Chart 2: L∆∞∆°ng
    var ctx2 = document.getElementById('staffChart');
    if (staffChart) staffChart.destroy();
    
    staffChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Tri·ªÅu', 'T√®o', 'Thi·ªán', 'Thu·∫≠n'],
            datasets: [{
                label: 'L∆∞∆°ng (ƒë)',
                data: [trieu, teo, thien, thuan],
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}

// Hi·ªán modal h∆∞·ªõng d·∫´n
function showSetupModal() {
    var modal = new bootstrap.Modal(document.getElementById('setupModal'));
    modal.show();
}

// Kh·ªüi ƒë·ªông
$(document).ready(function() {
    console.log('Trang ƒë√£ load. Click "D√πng d·ªØ li·ªáu m·∫´u" ƒë·ªÉ b·∫Øt ƒë·∫ßu.');
});
</script>
</body>
</html>
