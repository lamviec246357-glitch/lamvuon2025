<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ph√≠ l√†m v∆∞·ªùn - T·ª± ƒë·ªông c·∫≠p nh·∫≠t</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7f0;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }
        
        header {
            text-align: center;
            margin-bottom: 45px;
            padding-bottom: 30px;
            border-bottom: 4px solid #4CAF50;
            position: relative;
        }
        
        header::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 25%;
            width: 50%;
            height: 4px;
            background: linear-gradient(90deg, transparent, #4CAF50, transparent);
        }
        
        h1 {
            color: #2d5c2a;
            margin-bottom: 10px;
            font-size: 2.8em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .update-info {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .update-item {
            margin: 10px;
        }
        
        .update-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .card {
            background: linear-gradient(145deg, #ffffff, #f8fff8);
            border-radius: 18px;
            padding: 28px;
            text-align: center;
            border: 2px solid #4CAF50;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
        }
        
        .card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            color: #2d5c2a;
            margin-bottom: 25px;
            font-size: 1.4em;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .card-icon {
            font-size: 1.6em;
        }
        
        .amount {
            font-size: 2.5em;
            font-weight: bold;
            color: #4CAF50;
            margin: 25px 0;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .note {
            color: #666;
            font-size: 0.95em;
            margin-top: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }
        
        .button-container {
            text-align: center;
            margin: 50px 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .action-button {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 18px 45px;
            font-size: 1.2em;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }
        
        .action-button:hover {
            background: linear-gradient(135deg, #45a049, #1B5E20);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.4);
        }
        
        .action-button:active {
            transform: translateY(-1px);
        }
        
        .action-button.secondary {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }
        
        .action-button.secondary:hover {
            background: linear-gradient(135deg, #1976D2, #0D47A1);
        }
        
        .action-button.tertiary {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
        }
        
        .action-button.tertiary:hover {
            background: linear-gradient(135deg, #7B1FA2, #4A148C);
        }
        
        .action-button.export {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .action-button.export:hover {
            background: linear-gradient(135deg, #F57C00, #E65100);
        }
        
        .detail-section, .chart-section, .search-section, .export-section {
            background: #f9f9f9;
            border-radius: 18px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #e0e0e0;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .chart-section.active, .search-section.active, .export-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .detail-header, .chart-header, .search-header, .export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
            font-size: 1.1em;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        th {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            border-bottom: 1px solid #eee;
            padding: 16px 15px;
            text-align: left;
        }
        
        tr:hover {
            background-color: #f5f9f5;
            transition: background-color 0.2s;
        }
        
        .data-info {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #4CAF50;
        }
        
        footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #eee;
            color: #777;
            font-size: 0.95em;
        }
        
        .auto-update {
            background: #e3f2fd;
            padding: 12px 20px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(33, 150, 243, 0); }
            100% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0); }
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
        }
        
        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
        }
        
        /* Styles for charts */
        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
            position: relative;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
            border: 2px solid #e0e0e0;
        }
        
        /* Search and filter styles */
        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            min-width: 200px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .search-results-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reset-button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .reset-button:hover {
            background: #f57c00;
        }
        
        .highlight {
            background-color: #ffff99 !important;
            font-weight: bold;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #f44336;
            font-size: 1.2em;
        }
        
        .chart-type-selector {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .chart-type-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chart-type-btn.active {
            background: #4CAF50;
            color: white;
        }
        
        .chart-type-btn:hover {
            background: #e0e0e0;
        }
        
        .chart-type-btn.active:hover {
            background: #45a049;
        }
        
        /* Export section styles */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .export-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .export-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.12);
        }
        
        .export-icon {
            font-size: 3em;
            margin-bottom: 20px;
            display: block;
        }
        
        .export-card h3 {
            color: #2d5c2a;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .export-description {
            color: #666;
            margin-bottom: 25px;
            font-size: 0.95em;
            line-height: 1.5;
        }
        
        .export-button {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }
        
        .export-button.excel {
            background: linear-gradient(135deg, #0d7a3e, #0a5c2e);
        }
        
        .export-button.excel:hover {
            background: linear-gradient(135deg, #0a5c2e, #083e1f);
        }
        
        .export-button.pdf {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
        }
        
        .export-button.pdf:hover {
            background: linear-gradient(135deg, #b71c1c, #8b0000);
        }
        
        .export-button.summary {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }
        
        .export-button.summary:hover {
            background: linear-gradient(135deg, #1976D2, #0D47A1);
        }
        
        .export-preview {
            margin-top: 40px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
        }
        
        .export-preview h3 {
            color: #2d5c2a;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .preview-table th {
            background: #4CAF50;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .preview-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .preview-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .export-progress {
            display: none;
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            background: #e8f5e9;
            border-radius: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .amount {
                font-size: 2em;
            }
            
            h1 {
                font-size: 2em;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .button-container {
                flex-direction: column;
                align-items: center;
            }
            
            .action-button {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
        }
        
        .currency {
            font-size: 0.8em;
            color: #888;
            margin-left: 5px;
        }
        
        .last-updated {
            background: #fff3e0;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
    <!-- Chart.js library for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas for HTML to PDF conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåø CHI PH√ç L√ÄM V∆Ø·ªúN</h1>
            <p class="subtitle">H·ªá th·ªëng qu·∫£n l√Ω chi ph√≠ l√†m v∆∞·ªùn t·ª± ƒë·ªông</p>
            
            <div class="update-info">
                <div class="update-item">
                    <div>‚è∞ T·ª± ƒë·ªông c·∫≠p nh·∫≠t</div>
                    <div class="update-value" id="nextUpdate">3:00</div>
                    <div>ph√∫t n·ªØa</div>
                </div>
                <div class="update-item">
                    <div>üìä S·ªë h√†ng d·ªØ li·ªáu</div>
                    <div class="update-value" id="totalRows">0</div>
                    <div>h√†ng</div>
                </div>
                <div class="update-item">
                    <div>üîÑ L·∫ßn c·∫≠p nh·∫≠t cu·ªëi</div>
                    <div class="update-value" id="lastUpdateTime">--:--</div>
                    <div>gi·ªù</div>
                </div>
            </div>
        </header>
        
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="dataRows">0</div>
                <div class="stat-label">H√†ng d·ªØ li·ªáu</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="dataColumns">10</div>
                <div class="stat-label">C·ªôt d·ªØ li·ªáu</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="updateCount">0</div>
                <div class="stat-label">L·∫ßn c·∫≠p nh·∫≠t</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="autoUpdateStatus">üü¢</div>
                <div class="stat-label">T·ª± ƒë·ªông c·∫≠p nh·∫≠t</div>
            </div>
        </div>
        
        <div id="summary" class="summary-grid">
            <div class="card">
                <h3><span class="card-icon">üí∞</span> T·ªïng chi ph√≠ l√†m v∆∞·ªùn</h3>
                <div class="amount" id="totalChiPhi">0 ‚Ç´</div>
                <div class="note">T·ª± ƒë·ªông t√≠nh ƒë·∫øn h√†ng cu·ªëi c√πng trong sheet</div>
            </div>
            
            <div class="card">
                <h3><span class="card-icon">üõ†Ô∏è</span> T·ªïng ph√≠ v·∫≠t t∆∞</h3>
                <div class="amount" id="totalVatTu">0 ‚Ç´</div>
                <div class="note">SUM(D3:D) - T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi</div>
            </div>
            
            <div class="card">
                <h3><span class="card-icon">üë∑</span> T·ªïng ti·ªÅn c√¥ng</h3>
                <div class="amount" id="totalTienCong">0 ‚Ç´</div>
                <div class="note">SUM(E3:E) - T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi</div>
            </div>
            
            <div class="card">
                <h3><span class="card-icon">üë®</span> Tri·ªÅu</h3>
                <div class="amount" id="totalTrieu">0 ‚Ç´</div>
                <div class="note">SUM(G3:G) - T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi</div>
            </div>
            
            <div class="card">
                <h3><span class="card-icon">üë®</span> T√®o</h3>
                <div class="amount" id="totalTeo">0 ‚Ç´</div>
                <div class="note">SUM(H3:H) - T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi</div>
            </div>
            
            <div class="card">
                <h3><span class="card-icon">üë®</span> Thi·ªán</h3>
                <div class="amount" id="totalThien">0 ‚Ç´</div>
                <div class="note">SUM(I3:I) - T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi</div>
            </div>
            
            <div class="card">
                <h3><span class="card-icon">üë®</span> Thu·∫≠n</h3>
                <div class="amount" id="totalThuan">0 ‚Ç´</div>
                <div class="note">SUM(J3:J) - T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi</div>
            </div>
        </div>
        
        <div class="button-container">
            <button class="action-button" onclick="toggleDetail()">
                <span>üìã</span>
                <span id="detailButtonText">Xem chi ti·∫øt d·ªØ li·ªáu</span>
            </button>
            
            <button class="action-button secondary" onclick="toggleChartSection()">
                <span>üìä</span>
                <span id="chartButtonText">Xem bi·ªÉu ƒë·ªì</span>
            </button>
            
            <button class="action-button tertiary" onclick="toggleSearchSection()">
                <span>üîç</span>
                <span id="searchButtonText">T√¨m ki·∫øm & L·ªçc</span>
            </button>
            
            <button class="action-button export" onclick="toggleExportSection()">
                <span>üì§</span>
                <span id="exportButtonText">Xu·∫•t file</span>
            </button>
        </div>
        
        <div id="detailSection" class="detail-section">
            <div class="detail-header">
                <h2 style="color: #2d5c2a; margin: 0;">üìä Chi ti·∫øt c√°c kho·∫£n chi</h2>
                <button class="action-button" onclick="toggleDetail()" style="background: linear-gradient(135deg, #666, #444); padding: 12px 25px;">
                    <span>‚úï</span> ƒê√≥ng
                </button>
            </div>
            
            <div class="loading" id="loadingDetail">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet</div>
            <div id="detailContent"></div>
        </div>
        
        <div id="chartSection" class="chart-section">
            <div class="chart-header">
                <h2 style="color: #2d5c2a; margin: 0;">üìä Bi·ªÉu ƒë·ªì tr·ª±c quan h√≥a d·ªØ li·ªáu</h2>
                <button class="action-button" onclick="toggleChartSection()" style="background: linear-gradient(135deg, #666, #444); padding: 12px 25px;">
                    <span>‚úï</span> ƒê√≥ng
                </button>
            </div>
            
            <div class="chart-type-selector">
                <button class="chart-type-btn active" onclick="changeChartType('pie')">Bi·ªÉu ƒë·ªì tr√≤n</button>
                <button class="chart-type-btn" onclick="changeChartType('bar')">Bi·ªÉu ƒë·ªì c·ªôt</button>
                <button class="chart-type-btn" onclick="changeChartType('line')">Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng</button>
                <button class="chart-type-btn" onclick="changeChartType('doughnut')">Bi·ªÉu ƒë·ªì v√†nh khuy√™n</button>
            </div>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 style="color: #2d5c2a; margin-bottom: 15px; text-align: center;">Ph√¢n b·ªï chi ph√≠ l√†m v∆∞·ªùn</h3>
                    <div class="chart-container">
                        <canvas id="costDistributionChart"></canvas>
                    </div>
                    <div class="chart-legend" id="costChartLegend"></div>
                </div>
                
                <div class="chart-card">
                    <h3 style="color: #2d5c2a; margin-bottom: 15px; text-align: center;">Ti·ªÅn c√¥ng theo c√¥ng nh√¢n</h3>
                    <div class="chart-container">
                        <canvas id="workerChart"></canvas>
                    </div>
                    <div class="chart-legend" id="workerChartLegend"></div>
                </div>
            </div>
            
            <div class="chart-card" style="margin-top: 30px;">
                <h3 style="color: #2d5c2a; margin-bottom: 15px; text-align: center;">Xu h∆∞·ªõng chi ph√≠ theo th·ªùi gian</h3>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
                <div style="text-align: center; margin-top: 20px; font-size: 0.9em; color: #666;">
                    <p>Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán t·ªïng chi ph√≠ v·∫≠t t∆∞ v√† ti·ªÅn c√¥ng theo th·ªùi gian</p>
                </div>
            </div>
        </div>
        
        <div id="searchSection" class="search-section">
            <div class="search-header">
                <h2 style="color: #2d5c2a; margin: 0;">üîç T√¨m ki·∫øm & L·ªçc d·ªØ li·ªáu</h2>
                <button class="action-button" onclick="toggleSearchSection()" style="background: linear-gradient(135deg, #666, #444); padding: 12px 25px;">
                    <span>‚úï</span> ƒê√≥ng
                </button>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="T√¨m ki·∫øm theo n·ªôi dung, ID, ng√†y..." onkeyup="filterTable()">
                <button onclick="clearSearch()" class="reset-button">X√≥a t√¨m ki·∫øm</button>
            </div>
            
            <div class="filter-controls">
                <select id="categoryFilter" class="filter-select" onchange="filterTable()">
                    <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                    <option value="vat_tu">Ph√≠ v·∫≠t t∆∞</option>
                    <option value="tien_cong">Ti·ªÅn c√¥ng</option>
                </select>
                
                <select id="workerFilter" class="filter-select" onchange="filterTable()">
                    <option value="">T·∫•t c·∫£ c√¥ng nh√¢n</option>
                    <option value="Tri·ªÅu">Tri·ªÅu</option>
                    <option value="T√®o">T√®o</option>
                    <option value="Thi·ªán">Thi·ªán</option>
                    <option value="Thu·∫≠n">Thu·∫≠n</option>
                </select>
                
                <select id="amountFilter" class="filter-select" onchange="filterTable()">
                    <option value="">M·ªçi m·ª©c chi ph√≠</option>
                    <option value="0-500000">D∆∞·ªõi 500,000 ‚Ç´</option>
                    <option value="500000-1000000">500,000 - 1,000,000 ‚Ç´</option>
                    <option value="1000000-5000000">1,000,000 - 5,000,000 ‚Ç´</option>
                    <option value="5000000+">Tr√™n 5,000,000 ‚Ç´</option>
                </select>
            </div>
            
            <div id="searchResultsInfo" class="search-results-info" style="display: none;">
                <span id="resultsCount">0 k·∫øt qu·∫£</span>
                <button onclick="clearAllFilters()" class="reset-button">X√≥a t·∫•t c·∫£ b·ªô l·ªçc</button>
            </div>
            
            <div id="searchResults" style="overflow-x: auto;">
                <!-- Search results will be displayed here -->
            </div>
        </div>
        
        <div id="exportSection" class="export-section">
            <div class="export-header">
                <h2 style="color: #2d5c2a; margin: 0;">üì§ Xu·∫•t d·ªØ li·ªáu ra file</h2>
                <button class="action-button" onclick="toggleExportSection()" style="background: linear-gradient(135deg, #666, #444); padding: 12px 25px;">
                    <span>‚úï</span> ƒê√≥ng
                </button>
            </div>
            
            <div class="export-options">
                <div class="export-card">
                    <span class="export-icon">üìä</span>
                    <h3>Xu·∫•t to√†n b·ªô d·ªØ li·ªáu</h3>
                    <p class="export-description">Xu·∫•t t·∫•t c·∫£ d·ªØ li·ªáu chi ph√≠ l√†m v∆∞·ªùn t·ª´ Google Sheet ra file Excel (.xlsx) v·ªõi ƒë·∫ßy ƒë·ªß th√¥ng tin.</p>
                    <button class="export-button excel" onclick="exportAllData()">
                        <span>üì•</span> Xu·∫•t Excel
                    </button>
                </div>
                
                <div class="export-card">
                    <span class="export-icon">üìà</span>
                    <h3>Xu·∫•t t·ªïng k·∫øt b√°o c√°o</h3>
                    <p class="export-description">Xu·∫•t b√°o c√°o t·ªïng k·∫øt v·ªõi c√°c bi·ªÉu ƒë·ªì v√† th·ªëng k√™ chi ti·∫øt ra file PDF.</p>
                    <button class="export-button pdf" onclick="exportSummaryReport()">
                        <span>üì•</span> Xu·∫•t PDF
                    </button>
                </div>
                
                <div class="export-card">
                    <span class="export-icon">üîç</span>
                    <h3>Xu·∫•t k·∫øt qu·∫£ t√¨m ki·∫øm</h3>
                    <p class="export-description">Xu·∫•t k·∫øt qu·∫£ t√¨m ki·∫øm hi·ªán t·∫°i (n·∫øu c√≥) ra file Excel ƒë·ªÉ ph√¢n t√≠ch th√™m.</p>
                    <button class="export-button summary" onclick="exportSearchResults()">
                        <span>üì•</span> Xu·∫•t k·∫øt qu·∫£
                    </button>
                </div>
            </div>
            
            <div class="export-preview">
                <h3>üëÅÔ∏è Xem tr∆∞·ªõc d·ªØ li·ªáu s·∫Ω xu·∫•t</h3>
                <div style="overflow-x: auto; max-height: 300px;">
                    <table class="preview-table" id="exportPreviewTable">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>ID</th>
                                <th>Ng√†y</th>
                                <th>N·ªôi dung</th>
                                <th>Ph√≠ v·∫≠t t∆∞</th>
                                <th>Ti·ªÅn c√¥ng</th>
                                <th>T·ªïng</th>
                            </tr>
                        </thead>
                        <tbody id="exportPreviewBody">
                            <!-- Preview rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <p style="text-align: center; margin-top: 15px; color: #666; font-size: 0.9em;">
                    Hi·ªÉn th·ªã 5 d√≤ng ƒë·∫ßu ti√™n c·ªßa d·ªØ li·ªáu. T·ªïng c·ªông c√≥ <span id="totalPreviewRows">0</span> d√≤ng d·ªØ li·ªáu.
                </p>
            </div>
            
            <div class="export-progress" id="exportProgress">
                <h3>‚è≥ ƒêang xu·∫•t file...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...</p>
            </div>
        </div>
        
        <div class="data-info">
            <h3 style="color: #2d5c2a; margin-bottom: 15px;">‚ÑπÔ∏è Th√¥ng tin h·ªá th·ªëng</h3>
            <p><strong>Google Sheet ID:</strong> 1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4</p>
            <p><strong>Sheet name:</strong> SR2526</p>
            <p><strong>T√≠nh t·ªïng:</strong> T·ª± ƒë·ªông ƒë·∫øn h√†ng cu·ªëi c√πng trong sheet</p>
            <p><strong>T·ª± ƒë·ªông c·∫≠p nh·∫≠t:</strong> M·ªói 3 ph√∫t</p>
            <p><strong>Tr·∫°ng th√°i:</strong> <span id="connectionStatus" style="color: #4CAF50;">‚úÖ ƒêang k·∫øt n·ªëi...</span></p>
            
            <div class="auto-update">
                <span>üîÑ</span>
                <span>T·ª± ƒë·ªông c·∫≠p nh·∫≠t sau: <span id="countdownTimer">180</span> gi√¢y</span>
            </div>
        </div>
        
        <footer>
            <p>H·ªá th·ªëng qu·∫£n l√Ω chi ph√≠ l√†m v∆∞·ªùn - T·ª± ƒë·ªông ƒë·ªìng b·ªô v·ªõi Google Sheet</p>
            <p>¬© 2025 - <span id="currentYear"></span> | C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <span id="lastUpdate">ƒêang t·∫£i...</span></p>
            <div class="last-updated">
                ‚è±Ô∏è Th·ªùi gian th·ª±c: <span id="currentTime">--:--:--</span>
            </div>
        </footer>
    </div>

    <script>
        // ============================
        // C·∫§U H√åNH H·ªÜ TH·ªêNG
        // ============================
        const SHEET_ID = '1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4';
        const SHEET_NAME = 'SR2526';
        const AUTO_UPDATE_INTERVAL = 3 * 60 * 1000; // 3 ph√∫t (ƒë·ªïi th√†nh mili gi√¢y)
        const START_ROW = 3; // B·∫Øt ƒë·∫ßu t√≠nh t·ª´ h√†ng 3
        
        // Bi·∫øn h·ªá th·ªëng
        let updateCount = 0;
        let lastUpdateTime = null;
        let autoUpdateTimer = null;
        let countdownTimer = null;
        let countdownSeconds = AUTO_UPDATE_INTERVAL / 1000;
        let isDetailVisible = false;
        let isChartVisible = false;
        let isSearchVisible = false;
        let isExportVisible = false;
        let currentChartType = 'pie';
        
        // D·ªØ li·ªáu v√† bi·ªÉu ƒë·ªì
        let currentRows = [];
        let costChart = null;
        let workerChart = null;
        let trendChart = null;
        let currentFilteredRows = [];
        
        // ============================
        // KH·ªûI T·∫†O H·ªÜ TH·ªêNG
        // ============================
        
        // Kh·ªüi t·∫°o th·ªùi gian
        function initSystem() {
            // C√†i ƒë·∫∑t nƒÉm hi·ªán t·∫°i
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // C√†i ƒë·∫∑t th·ªùi gian th·ª±c
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // C√†i ƒë·∫∑t countdown timer
            startCountdown();
            
            // T·∫£i d·ªØ li·ªáu l·∫ßn ƒë·∫ßu
            loadData();
            
            // B·∫Øt ƒë·∫ßu t·ª± ƒë·ªông c·∫≠p nh·∫≠t
            startAutoUpdate();
        }
        
        // C·∫≠p nh·∫≠t th·ªùi gian hi·ªán t·∫°i
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('vi-VN');
            document.getElementById('currentTime').textContent = timeString;
        }
        
        // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c
        function startCountdown() {
            countdownSeconds = AUTO_UPDATE_INTERVAL / 1000;
            
            if (countdownTimer) {
                clearInterval(countdownTimer);
            }
            
            countdownTimer = setInterval(() => {
                countdownSeconds--;
                
                // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
                const minutes = Math.floor(countdownSeconds / 60);
                const seconds = countdownSeconds % 60;
                
                document.getElementById('countdownTimer').textContent = countdownSeconds;
                document.getElementById('nextUpdate').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Khi h·∫øt gi·ªù
                if (countdownSeconds <= 0) {
                    clearInterval(countdownTimer);
                    loadData(); // T·∫£i d·ªØ li·ªáu m·ªõi
                    startCountdown(); // Kh·ªüi ƒë·ªông l·∫°i countdown
                }
            }, 1000);
        }
        
        // B·∫Øt ƒë·∫ßu t·ª± ƒë·ªông c·∫≠p nh·∫≠t
        function startAutoUpdate() {
            if (autoUpdateTimer) {
                clearInterval(autoUpdateTimer);
            }
            
            autoUpdateTimer = setInterval(() => {
                loadData();
            }, AUTO_UPDATE_INTERVAL);
            
            document.getElementById('autoUpdateStatus').textContent = 'üü¢';
            document.getElementById('autoUpdateStatus').style.color = '#4CAF50';
        }
        
        // ============================
        // X·ª¨ L√ù D·ªÆ LI·ªÜU
        // ============================
        
        // T·∫£i d·ªØ li·ªáu t·ª´ Google Sheet
        async function loadData() {
            try {
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i
                document.getElementById('connectionStatus').textContent = 'üîÑ ƒêang t·∫£i d·ªØ li·ªáu...';
                document.getElementById('connectionStatus').style.color = '#FF9800';
                
                // S·ª≠ d·ª•ng ph∆∞∆°ng ph√°p CSV (·ªïn ƒë·ªãnh nh·∫•t)
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
                const response = await fetch(csvUrl);
                
                if (!response.ok) {
                    throw new Error(`L·ªói k·∫øt n·ªëi: ${response.status}`);
                }
                
                const csvText = await response.text();
                currentRows = parseCSV(csvText);
                
                // C·∫≠p nh·∫≠t th√¥ng tin h·ªá th·ªëng
                updateCount++;
                lastUpdateTime = new Date();
                
                document.getElementById('totalRows').textContent = currentRows.length;
                document.getElementById('updateCount').textContent = updateCount;
                document.getElementById('lastUpdateTime').textContent = 
                    lastUpdateTime.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
                
                // T√≠nh t·ªïng v√† hi·ªÉn th·ªã
                calculateAndDisplayTotals(currentRows);
                
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng
                document.getElementById('connectionStatus').textContent = `‚úÖ K·∫øt n·ªëi th√†nh c√¥ng (${currentRows.length} h√†ng)`;
                document.getElementById('connectionStatus').style.color = '#4CAF50';
                
                // C·∫≠p nh·∫≠t th·ªùi gian cu·ªëi
                document.getElementById('lastUpdate').textContent = 
                    lastUpdateTime.toLocaleString('vi-VN', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                
                // N·∫øu ƒëang xem chi ti·∫øt, c·∫≠p nh·∫≠t b·∫£ng
                if (isDetailVisible) {
                    displayDetailTable(currentRows);
                }
                
                // N·∫øu ƒëang xem bi·ªÉu ƒë·ªì, c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì
                if (isChartVisible) {
                    updateCharts(currentRows);
                }
                
                // N·∫øu ƒëang xem t√¨m ki·∫øm, c·∫≠p nh·∫≠t k·∫øt qu·∫£
                if (isSearchVisible) {
                    filterTable();
                }
                
                // N·∫øu ƒëang xem xu·∫•t file, c·∫≠p nh·∫≠t preview
                if (isExportVisible) {
                    updateExportPreview();
                }
                
                console.log(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu l·∫ßn th·ª© ${updateCount} (${currentRows.length} h√†ng)`);
                
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                
                document.getElementById('connectionStatus').textContent = '‚ùå L·ªói k·∫øt n·ªëi';
                document.getElementById('connectionStatus').style.color = '#f44336';
                
                // Th·ª≠ l·∫°i sau 30 gi√¢y n·∫øu c√≥ l·ªói
                setTimeout(loadData, 30000);
            }
        }
        
        // Ph√¢n t√≠ch CSV
        function parseCSV(csvText) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentField);
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentRow.push(currentField);
                    rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                } else if (char === '\r') {
                    continue;
                } else {
                    currentField += char;
                }
            }
            
            // Th√™m d√≤ng cu·ªëi
            if (currentField || currentRow.length > 0) {
                currentRow.push(currentField);
                rows.push(currentRow);
            }
            
            return rows;
        }
        
        // ƒê·ªãnh d·∫°ng ti·ªÅn Vi·ªát Nam (cho t·ªïng)
        function formatCurrency(value) {
            if (value === null || value === undefined || isNaN(value)) {
                return '0 ‚Ç´';
            }
            
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }
        
        // Hi·ªÉn th·ªã s·ªë ti·ªÅn ƒë√∫ng ƒë·ªãnh d·∫°ng (cho b·∫£ng chi ti·∫øt - GI·ªÆ NGUY√äN D·∫§U CH·∫§M)
        function displayAmount(value) {
            if (!value && value !== 0) return '0 ‚Ç´';
            
            // N·∫øu ƒë√£ l√† chu·ªói r·ªóng ho·∫∑c "0"
            if (value === '' || value === '0') return '0 ‚Ç´';
            
            // N·∫øu ƒë√£ c√≥ ƒë·ªãnh d·∫°ng ti·ªÅn (c√≥ d·∫•u . ph√¢n c√°ch ngh√¨n)
            if (typeof value === 'string') {
                // Ki·ªÉm tra n·∫øu ƒë√£ c√≥ d·∫•u ch·∫•m ph√¢n c√°ch ngh√¨n (v√≠ d·ª•: 300.000, 1.500.000)
                if (value.includes('.') && value.split('.').length > 1) {
                    // Gi·ªØ nguy√™n v√† th√™m k√Ω hi·ªáu ti·ªÅn n·∫øu ch∆∞a c√≥
                    if (!value.includes('‚Ç´') && !value.includes('ƒë')) {
                        return value + ' ‚Ç´';
                    }
                    return value;
                }
                
                // N·∫øu l√† s·ªë nguy√™n kh√¥ng c√≥ d·∫•u ch·∫•m (v√≠ d·ª•: 300000)
                if (/^\d+$/.test(value)) {
                    // Th√™m d·∫•u ch·∫•m ph√¢n c√°ch ngh√¨n
                    return parseInt(value).toLocaleString('vi-VN') + ' ‚Ç´';
                }
                
                // Gi·ªØ nguy√™n v√† th√™m k√Ω hi·ªáu ti·ªÅn n·∫øu ch∆∞a c√≥
                if (!value.includes('‚Ç´') && !value.includes('ƒë')) {
                    return value + ' ‚Ç´';
                }
                return value;
            }
            
            // N·∫øu l√† s·ªë, ƒë·ªãnh d·∫°ng l·∫°i
            if (typeof value === 'number') {
                return value.toLocaleString('vi-VN') + ' ‚Ç´';
            }
            
            return '0 ‚Ç´';
        }
        
        // Chuy·ªÉn ƒë·ªïi s·ªë t·ª´ Google Sheet (cho t√≠nh to√°n)
        function parseSheetNumber(value) {
            if (!value && value !== 0) return 0;
            
            if (typeof value === 'string') {
                // X√≥a t·∫•t c·∫£ d·∫•u ch·∫•m ph√¢n c√°ch ngh√¨n
                let cleanValue = value.replace(/\./g, '');
                // Thay d·∫•u ph·∫©y th·∫≠p ph√¢n th√†nh d·∫•u ch·∫•m
                cleanValue = cleanValue.replace(',', '.');
                // X√≥a k√Ω t·ª± kh√¥ng ph·∫£i s·ªë
                cleanValue = cleanValue.replace(/[^\d.-]/g, '');
                
                const num = parseFloat(cleanValue);
                return isNaN(num) ? 0 : num;
            }
            
            return parseFloat(value) || 0;
        }
        
        // T√≠nh t·ªïng v√† hi·ªÉn th·ªã
        function calculateAndDisplayTotals(rows) {
            let totalVatTu = 0;
            let totalTienCong = 0;
            let totalTrieu = 0;
            let totalTeo = 0;
            let totalThien = 0;
            let totalThuan = 0;
            
            let dataRowsCount = 0;
            
            // B·∫Øt ƒë·∫ßu t·ª´ h√†ng START_ROW (index START_ROW-1) ƒë·∫øn h√†ng cu·ªëi c√πng
            for (let i = START_ROW - 1; i < rows.length; i++) {
                const row = rows[i];
                dataRowsCount++;
                
                // C·ªôt D (index 3): Ph√≠ v·∫≠t t∆∞
                if (row[3]) {
                    totalVatTu += parseSheetNumber(row[3]);
                }
                
                // C·ªôt E (index 4): Ti·ªÅn c√¥ng
                if (row[4]) {
                    totalTienCong += parseSheetNumber(row[4]);
                }
                
                // C·ªôt G (index 6): Tri·ªÅu
                if (row[6]) {
                    totalTrieu += parseSheetNumber(row[6]);
                }
                
                // C·ªôt H (index 7): T√®o
                if (row[7]) {
                    totalTeo += parseSheetNumber(row[7]);
                }
                
                // C·ªôt I (index 8): Thi·ªán
                if (row[8]) {
                    totalThien += parseSheetNumber(row[8]);
                }
                
                // C·ªôt J (index 9): Thu·∫≠n
                if (row[9]) {
                    totalThuan += parseSheetNumber(row[9]);
                }
            }
            
            const totalChiPhi = totalVatTu + totalTienCong;
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            document.getElementById('totalChiPhi').textContent = formatCurrency(totalChiPhi);
            document.getElementById('totalVatTu').textContent = formatCurrency(totalVatTu);
            document.getElementById('totalTienCong').textContent = formatCurrency(totalTienCong);
            document.getElementById('totalTrieu').textContent = formatCurrency(totalTrieu);
            document.getElementById('totalTeo').textContent = formatCurrency(totalTeo);
            document.getElementById('totalThien').textContent = formatCurrency(totalThien);
            document.getElementById('totalThuan').textContent = formatCurrency(totalThuan);
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            document.getElementById('dataRows').textContent = dataRowsCount;
            
            console.log('T·ªïng k·∫øt:', {
                'T·ªïng h√†ng d·ªØ li·ªáu': dataRowsCount,
                'Ph√≠ v·∫≠t t∆∞': formatCurrency(totalVatTu),
                'Ti·ªÅn c√¥ng': formatCurrency(totalTienCong),
                'T·ªïng chi ph√≠': formatCurrency(totalChiPhi)
            });
        }
        
        // ============================
        // HI·ªÇN TH·ªä CHI TI·∫æT
        // ============================
        
        // Hi·ªÉn th·ªã/·∫©n chi ti·∫øt
        function toggleDetail() {
            const detailSection = document.getElementById('detailSection');
            const detailButton = document.getElementById('detailButtonText');
            
            isDetailVisible = !isDetailVisible;
            
            if (isDetailVisible) {
                detailSection.style.display = 'block';
                detailButton.textContent = '·∫®n chi ti·∫øt';
                
                // T·∫£i v√† hi·ªÉn th·ªã d·ªØ li·ªáu chi ti·∫øt
                loadDetailData();
            } else {
                detailSection.style.display = 'none';
                detailButton.textContent = 'Xem chi ti·∫øt d·ªØ li·ªáu';
            }
        }
        
        // T·∫£i d·ªØ li·ªáu chi ti·∫øt
        async function loadDetailData() {
            try {
                document.getElementById('loadingDetail').style.display = 'block';
                document.getElementById('detailContent').innerHTML = '';
                
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
                const response = await fetch(csvUrl);
                
                if (!response.ok) {
                    throw new Error('L·ªói t·∫£i d·ªØ li·ªáu');
                }
                
                const csvText = await response.text();
                const rows = parseCSV(csvText);
                
                displayDetailTable(rows);
                
                document.getElementById('loadingDetail').style.display = 'none';
                
            } catch (error) {
                console.error('L·ªói t·∫£i chi ti·∫øt:', error);
                document.getElementById('detailContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #f44336;">
                        <h3>‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu chi ti·∫øt</h3>
                        <p>Vui l√≤ng th·ª≠ l·∫°i sau</p>
                        <button onclick="loadDetailData()" style="margin-top: 20px; padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Th·ª≠ l·∫°i
                        </button>
                    </div>
                `;
                document.getElementById('loadingDetail').style.display = 'none';
            }
        }
        
        // Hi·ªÉn th·ªã b·∫£ng chi ti·∫øt
        function displayDetailTable(rows) {
            let html = `
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ID</th>
                                <th>Ng√†y</th>
                                <th>N·ªôi dung</th>
                                <th>Ph√≠ v·∫≠t t∆∞</th>
                                <th>Ti·ªÅn c√¥ng</th>
                                <th>Tri·ªÅu</th>
                                <th>T√®o</th>
                                <th>Thi·ªán</th>
                                <th>Thu·∫≠n</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let displayedCount = 0;
            
            // B·∫Øt ƒë·∫ßu t·ª´ h√†ng START_ROW
            for (let i = START_ROW - 1; i < rows.length; i++) {
                const row = rows[i];
                const rowNumber = i + 1;
                
                if (row && row.length >= 5) {
                    html += `
                        <tr>
                            <td>${rowNumber}</td>
                            <td>${row[0] || ''}</td>
                            <td>${row[1] || ''}</td>
                            <td>${row[2] || ''}</td>
                            <td>${displayAmount(row[3])}</td>
                            <td>${displayAmount(row[4])}</td>
                            <td>${displayAmount(row[6])}</td>
                            <td>${displayAmount(row[7])}</td>
                            <td>${displayAmount(row[8])}</td>
                            <td>${displayAmount(row[9])}</td>
                        </tr>
                    `;
                    displayedCount++;
                }
            }
            
            html += `
                        </tbody>
                    </table>
                    <div class="data-info" style="margin-top: 25px;">
                        <p><strong>üìà Th·ªëng k√™ chi ti·∫øt:</strong></p>
                        <p>T·ªïng s·ªë h√†ng d·ªØ li·ªáu: ${displayedCount} (t·ª´ h√†ng ${START_ROW} ƒë·∫øn ${rows.length})</p>
                        <p>Th·ªùi gian c·∫≠p nh·∫≠t: ${new Date().toLocaleTimeString('vi-VN')}</p>
                        <p>L·∫ßn c·∫≠p nh·∫≠t th·ª©: ${updateCount}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('detailContent').innerHTML = html;
        }
        
        // ============================
        // BI·ªÇU ƒê·ªí TR·ª∞C QUAN
        // ============================
        
        // Hi·ªÉn th·ªã/·∫©n bi·ªÉu ƒë·ªì
        function toggleChartSection() {
            const chartSection = document.getElementById('chartSection');
            const chartButton = document.getElementById('chartButtonText');
            
            isChartVisible = !isChartVisible;
            
            if (isChartVisible) {
                chartSection.classList.add('active');
                chartButton.textContent = '·∫®n bi·ªÉu ƒë·ªì';
                
                // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì v·ªõi d·ªØ li·ªáu hi·ªán t·∫°i
                if (currentRows.length > 0) {
                    updateCharts(currentRows);
                } else {
                    loadData();
                }
            } else {
                chartSection.classList.remove('active');
                chartButton.textContent = 'Xem bi·ªÉu ƒë·ªì';
            }
        }
        
        // Thay ƒë·ªïi lo·∫°i bi·ªÉu ƒë·ªì
        function changeChartType(type) {
            currentChartType = type;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì
            if (currentRows.length > 0) {
                updateCharts(currentRows);
            }
        }
        
        // C·∫≠p nh·∫≠t t·∫•t c·∫£ bi·ªÉu ƒë·ªì
        function updateCharts(rows) {
            // X√≥a bi·ªÉu ƒë·ªì c≈© n·∫øu t·ªìn t·∫°i
            if (costChart) {
                costChart.destroy();
            }
            if (workerChart) {
                workerChart.destroy();
            }
            if (trendChart) {
                trendChart.destroy();
            }
            
            // T·∫°o bi·ªÉu ƒë·ªì m·ªõi
            createCostDistributionChart(rows);
            createWorkerChart(rows);
            createTrendChart(rows);
        }
        
        // T·∫°o bi·ªÉu ƒë·ªì ph√¢n b·ªï chi ph√≠
        function createCostDistributionChart(rows) {
            const ctx = document.getElementById('costDistributionChart').getContext('2d');
            
            let totalVatTu = 0;
            let totalTienCong = 0;
            
            for (let i = START_ROW - 1; i < rows.length; i++) {
                const row = rows[i];
                if (row[3]) totalVatTu += parseSheetNumber(row[3]);
                if (row[4]) totalTienCong += parseSheetNumber(row[4]);
            }
            
            const data = {
                labels: ['Ph√≠ v·∫≠t t∆∞', 'Ti·ªÅn c√¥ng'],
                datasets: [{
                    data: [totalVatTu, totalTienCong],
                    backgroundColor: [
                        'rgba(76, 175, 80, 0.8)',
                        'rgba(33, 150, 243, 0.8)'
                    ],
                    borderColor: [
                        'rgba(76, 175, 80, 1)',
                        'rgba(33, 150, 243, 1)'
                    ],
                    borderWidth: 2
                }]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: {
                                size: 14
                            },
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += formatCurrency(context.raw);
                                return label;
                            }
                        }
                    }
                }
            };
            
            costChart = new Chart(ctx, {
                type: currentChartType,
                data: data,
                options: options
            });
            
            // T·∫°o legend
            const legendHtml = `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(76, 175, 80, 0.8);"></div>
                    <span>Ph√≠ v·∫≠t t∆∞: ${formatCurrency(totalVatTu)}</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(33, 150, 243, 0.8);"></div>
                    <span>Ti·ªÅn c√¥ng: ${formatCurrency(totalTienCong)}</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(156, 39, 176, 0.8);"></div>
                    <span>T·ªïng: ${formatCurrency(totalVatTu + totalTienCong)}</span>
                </div>
            `;
            
            document.getElementById('costChartLegend').innerHTML = legendHtml;
        }
        
        // T·∫°o bi·ªÉu ƒë·ªì ti·ªÅn c√¥ng theo c√¥ng nh√¢n
        function createWorkerChart(rows) {
            const ctx = document.getElementById('workerChart').getContext('2d');
            
            let workerTotals = {
                'Tri·ªÅu': 0,
                'T√®o': 0,
                'Thi·ªán': 0,
                'Thu·∫≠n': 0
            };
            
            for (let i = START_ROW - 1; i < rows.length; i++) {
                const row = rows[i];
                if (row[6]) workerTotals['Tri·ªÅu'] += parseSheetNumber(row[6]);
                if (row[7]) workerTotals['T√®o'] += parseSheetNumber(row[7]);
                if (row[8]) workerTotals['Thi·ªán'] += parseSheetNumber(row[8]);
                if (row[9]) workerTotals['Thu·∫≠n'] += parseSheetNumber(row[9]);
            }
            
            const workerColors = [
                'rgba(255, 99, 132, 0.8)',
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)'
            ];
            
            const data = {
                labels: Object.keys(workerTotals),
                datasets: [{
                    label: 'Ti·ªÅn c√¥ng',
                    data: Object.values(workerTotals),
                    backgroundColor: workerColors,
                    borderColor: workerColors.map(color => color.replace('0.8', '1')),
                    borderWidth: 2
                }]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: {
                                size: 14
                            },
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += formatCurrency(context.raw);
                                return label;
                            }
                        }
                    }
                }
            };
            
            workerChart = new Chart(ctx, {
                type: currentChartType === 'line' ? 'bar' : currentChartType,
                data: data,
                options: options
            });
            
            // T·∫°o legend
            let legendHtml = '';
            let index = 0;
            for (const [worker, total] of Object.entries(workerTotals)) {
                legendHtml += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${workerColors[index]}"></div>
                        <span>${worker}: ${formatCurrency(total)}</span>
                    </div>
                `;
                index++;
            }
            
            document.getElementById('workerChartLegend').innerHTML = legendHtml;
        }
        
        // T·∫°o bi·ªÉu ƒë·ªì xu h∆∞·ªõng theo th·ªùi gian
        function createTrendChart(rows) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Nh√≥m d·ªØ li·ªáu theo ng√†y/th√°ng
            const monthlyData = {};
            
            for (let i = START_ROW - 1; i < rows.length; i++) {
                const row = rows[i];
                const dateStr = row[1] || '';
                const vatTu = parseSheetNumber(row[3]);
                const tienCong = parseSheetNumber(row[4]);
                
                if (dateStr) {
                    // T√°ch th√°ng/nƒÉm t·ª´ ng√†y
                    const dateParts = dateStr.split('/');
                    if (dateParts.length >= 2) {
                        const month = parseInt(dateParts[1]);
                        const year = dateParts.length === 3 ? parseInt(dateParts[2]) : new Date().getFullYear();
                        const key = `${month}/${year}`;
                        
                        if (!monthlyData[key]) {
                            monthlyData[key] = {
                                vatTu: 0,
                                tienCong: 0
                            };
                        }
                        
                        monthlyData[key].vatTu += vatTu;
                        monthlyData[key].tienCong += tienCong;
                    }
                }
            }
            
            // S·∫Øp x·∫øp theo th·ªùi gian
            const sortedKeys = Object.keys(monthlyData).sort((a, b) => {
                const [aMonth, aYear] = a.split('/').map(Number);
                const [bMonth, bYear] = b.split('/').map(Number);
                
                if (aYear !== bYear) return aYear - bYear;
                return aMonth - bMonth;
            });
            
            const labels = sortedKeys;
            const vatTuData = sortedKeys.map(key => monthlyData[key].vatTu);
            const tienCongData = sortedKeys.map(key => monthlyData[key].tienCong);
            
            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'Ph√≠ v·∫≠t t∆∞',
                        data: vatTuData,
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 3,
                        tension: 0.1,
                        fill: true
                    },
                    {
                        label: 'Ti·ªÅn c√¥ng',
                        data: tienCongData,
                        backgroundColor: 'rgba(33, 150, 243, 0.2)',
                        borderColor: 'rgba(33, 150, 243, 1)',
                        borderWidth: 3,
                        tension: 0.1,
                        fill: true
                    }
                ]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 14
                            },
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += formatCurrency(context.raw);
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                if (value >= 1000000) {
                                    return (value / 1000000).toFixed(1) + 'tr';
                                }
                                if (value >= 1000) {
                                    return (value / 1000).toFixed(0) + 'k';
                                }
                                return value;
                            }
                        }
                    }
                }
            };
            
            trendChart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options
            });
        }
        
        // ============================
        // T√åM KI·∫æM & L·ªåC D·ªÆ LI·ªÜU
        // ============================
        
        // Hi·ªÉn th·ªã/·∫©n ph·∫ßn t√¨m ki·∫øm
        function toggleSearchSection() {
            const searchSection = document.getElementById('searchSection');
            const searchButton = document.getElementById('searchButtonText');
            
            isSearchVisible = !isSearchVisible;
            
            if (isSearchVisible) {
                searchSection.classList.add('active');
                searchButton.textContent = '·∫®n t√¨m ki·∫øm';
                
                // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
                filterTable();
            } else {
                searchSection.classList.remove('active');
                searchButton.textContent = 'T√¨m ki·∫øm & L·ªçc';
            }
        }
        
        // L·ªçc v√† hi·ªÉn th·ªã b·∫£ng theo ti√™u ch√≠ t√¨m ki·∫øm
        function filterTable() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const workerFilter = document.getElementById('workerFilter').value;
            const amountFilter = document.getElementById('amountFilter').value;
            
            let filteredRows = [];
            let matchedRows = 0;
            
            // L·ªçc d·ªØ li·ªáu
            for (let i = START_ROW - 1; i < currentRows.length; i++) {
                const row = currentRows[i];
                const rowNumber = i + 1;
                
                if (row && row.length >= 5) {
                    let match = true;
                    
                    // L·ªçc theo t·ª´ kh√≥a t√¨m ki·∫øm
                    if (searchInput) {
                        const searchText = `${row[0] || ''} ${row[1] || ''} ${row[2] || ''}`.toLowerCase();
                        if (!searchText.includes(searchInput)) {
                            match = false;
                        }
                    }
                    
                    // L·ªçc theo danh m·ª•c
                    if (match && categoryFilter) {
                        if (categoryFilter === 'vat_tu') {
                            if (!row[3] || parseSheetNumber(row[3]) === 0) {
                                match = false;
                            }
                        } else if (categoryFilter === 'tien_cong') {
                            if (!row[4] || parseSheetNumber(row[4]) === 0) {
                                match = false;
                            }
                        }
                    }
                    
                    // L·ªçc theo c√¥ng nh√¢n
                    if (match && workerFilter) {
                        let workerAmount = 0;
                        if (workerFilter === 'Tri·ªÅu' && row[6]) workerAmount = parseSheetNumber(row[6]);
                        if (workerFilter === 'T√®o' && row[7]) workerAmount = parseSheetNumber(row[7]);
                        if (workerFilter === 'Thi·ªán' && row[8]) workerAmount = parseSheetNumber(row[8]);
                        if (workerFilter === 'Thu·∫≠n' && row[9]) workerAmount = parseSheetNumber(row[9]);
                        
                        if (workerAmount === 0) {
                            match = false;
                        }
                    }
                    
                    // L·ªçc theo m·ª©c chi ph√≠
                    if (match && amountFilter) {
                        const vatTu = parseSheetNumber(row[3]);
                        const tienCong = parseSheetNumber(row[4]);
                        const totalRow = vatTu + tienCong;
                        
                        if (amountFilter === '0-500000' && totalRow >= 500000) match = false;
                        if (amountFilter === '500000-1000000' && (totalRow < 500000 || totalRow >= 1000000)) match = false;
                        if (amountFilter === '1000000-5000000' && (totalRow < 1000000 || totalRow >= 5000000)) match = false;
                        if (amountFilter === '5000000+' && totalRow < 5000000) match = false;
                    }
                    
                    if (match) {
                        filteredRows.push({ index: i, row: row });
                        matchedRows++;
                    }
                }
            }
            
            // L∆∞u l·∫°i k·∫øt qu·∫£ l·ªçc
            currentFilteredRows = filteredRows;
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            displaySearchResults(filteredRows);
            
            // Hi·ªÉn th·ªã th√¥ng tin k·∫øt qu·∫£
            const resultsInfo = document.getElementById('searchResultsInfo');
            const resultsCount = document.getElementById('resultsCount');
            
            if (searchInput || categoryFilter || workerFilter || amountFilter) {
                resultsInfo.style.display = 'flex';
                resultsCount.textContent = `${matchedRows} k·∫øt qu·∫£`;
            } else {
                resultsInfo.style.display = 'none';
            }
            
            // C·∫≠p nh·∫≠t preview xu·∫•t file
            updateExportPreview();
        }
        
        // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
        function displaySearchResults(filteredRows) {
            const searchResults = document.getElementById('searchResults');
            
            if (filteredRows.length === 0) {
                searchResults.innerHTML = `
                    <div class="no-results">
                        <h3>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p</h3>
                        <p>H√£y th·ª≠ l·∫°i v·ªõi t·ª´ kh√≥a ho·∫∑c b·ªô l·ªçc kh√°c</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ID</th>
                                <th>Ng√†y</th>
                                <th>N·ªôi dung</th>
                                <th>Ph√≠ v·∫≠t t∆∞</th>
                                <th>Ti·ªÅn c√¥ng</th>
                                <th>Tri·ªÅu</th>
                                <th>T√®o</th>
                                <th>Thi·ªán</th>
                                <th>Thu·∫≠n</th>
                                <th>T·ªïng</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            filteredRows.forEach(({ index, row }) => {
                const rowNumber = index + 1;
                const vatTu = parseSheetNumber(row[3]);
                const tienCong = parseSheetNumber(row[4]);
                const totalRow = vatTu + tienCong;
                
                // T·∫°o c√°c √¥ v·ªõi highlight n·∫øu ph√π h·ª£p
                const highlightCell = (value, isSearchable = false) => {
                    if (isSearchable && searchInput && value.toLowerCase().includes(searchInput)) {
                        return `<span class="highlight">${value}</span>`;
                    }
                    return value;
                };
                
                html += `
                    <tr>
                        <td>${rowNumber}</td>
                        <td>${highlightCell(row[0] || '', true)}</td>
                        <td>${highlightCell(row[1] || '', true)}</td>
                        <td>${highlightCell(row[2] || '', true)}</td>
                        <td>${displayAmount(row[3])}</td>
                        <td>${displayAmount(row[4])}</td>
                        <td>${displayAmount(row[6])}</td>
                        <td>${displayAmount(row[7])}</td>
                        <td>${displayAmount(row[8])}</td>
                        <td>${displayAmount(row[9])}</td>
                        <td><strong>${formatCurrency(totalRow)}</strong></td>
                    </tr>
                `;
            });
            
            // T√≠nh t·ªïng cho c√°c h√†ng ƒë√£ l·ªçc
            let filteredVatTu = 0;
            let filteredTienCong = 0;
            let filteredTrieu = 0;
            let filteredTeo = 0;
            let filteredThien = 0;
            let filteredThuan = 0;
            
            filteredRows.forEach(({ row }) => {
                filteredVatTu += parseSheetNumber(row[3]);
                filteredTienCong += parseSheetNumber(row[4]);
                filteredTrieu += parseSheetNumber(row[6]);
                filteredTeo += parseSheetNumber(row[7]);
                filteredThien += parseSheetNumber(row[8]);
                filteredThuan += parseSheetNumber(row[9]);
            });
            
            const filteredTotal = filteredVatTu + filteredTienCong;
            
            html += `
                        </tbody>
                        <tfoot style="background-color: #f0f0f0; font-weight: bold;">
                            <tr>
                                <td colspan="4" style="text-align: right;">T·ªïng k·∫øt (${filteredRows.length} h√†ng):</td>
                                <td>${formatCurrency(filteredVatTu)}</td>
                                <td>${formatCurrency(filteredTienCong)}</td>
                                <td>${formatCurrency(filteredTrieu)}</td>
                                <td>${formatCurrency(filteredTeo)}</td>
                                <td>${formatCurrency(filteredThien)}</td>
                                <td>${formatCurrency(filteredThuan)}</td>
                                <td>${formatCurrency(filteredTotal)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="data-info" style="margin-top: 25px;">
                    <p><strong>üìä Th·ªëng k√™ k·∫øt qu·∫£ t√¨m ki·∫øm:</strong></p>
                    <p>T·ªïng s·ªë h√†ng: ${filteredRows.length} / ${currentRows.length - START_ROW + 1}</p>
                    <p>T·ªïng chi ph√≠: ${formatCurrency(filteredTotal)}</p>
                    <p>Chi ph√≠ trung b√¨nh m·ªói h√†ng: ${formatCurrency(filteredRows.length > 0 ? filteredTotal / filteredRows.length : 0)}</p>
                    <p>Th·ªùi gian t√¨m ki·∫øm: ${new Date().toLocaleTimeString('vi-VN')}</p>
                </div>
            `;
            
            searchResults.innerHTML = html;
        }
        
        // X√≥a t√¨m ki·∫øm
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            filterTable();
        }
        
        // X√≥a t·∫•t c·∫£ b·ªô l·ªçc
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('workerFilter').value = '';
            document.getElementById('amountFilter').value = '';
            filterTable();
        }
        
        // ============================
        // XU·∫§T FILE EXCEL V√Ä PDF
        // ============================
        
        // Hi·ªÉn th·ªã/·∫©n ph·∫ßn xu·∫•t file
        function toggleExportSection() {
            const exportSection = document.getElementById('exportSection');
            const exportButton = document.getElementById('exportButtonText');
            
            isExportVisible = !isExportVisible;
            
            if (isExportVisible) {
                exportSection.classList.add('active');
                exportButton.textContent = '·∫®n xu·∫•t file';
                
                // C·∫≠p nh·∫≠t preview
                updateExportPreview();
            } else {
                exportSection.classList.remove('active');
                exportButton.textContent = 'Xu·∫•t file';
            }
        }
        
        // C·∫≠p nh·∫≠t xem tr∆∞·ªõc d·ªØ li·ªáu xu·∫•t
        function updateExportPreview() {
            const previewBody = document.getElementById('exportPreviewBody');
            const totalRowsElement = document.getElementById('totalPreviewRows');
            
            // X√°c ƒë·ªãnh d·ªØ li·ªáu n√†o s·∫Ω xu·∫•t (to√†n b·ªô ho·∫∑c ƒë√£ l·ªçc)
            let rowsToPreview = [];
            let totalRows = 0;
            
            // Ki·ªÉm tra n·∫øu c√≥ k·∫øt qu·∫£ t√¨m ki·∫øm ƒëang hi·ªÉn th·ªã
            const searchInput = document.getElementById('searchInput').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const workerFilter = document.getElementById('workerFilter').value;
            const amountFilter = document.getElementById('amountFilter').value;
            
            const hasFilters = searchInput || categoryFilter || workerFilter || amountFilter;
            
            if (hasFilters && currentFilteredRows.length > 0) {
                // S·ª≠ d·ª•ng d·ªØ li·ªáu ƒë√£ l·ªçc
                rowsToPreview = currentFilteredRows.slice(0, 5); // L·∫•y 5 d√≤ng ƒë·∫ßu
                totalRows = currentFilteredRows.length;
            } else {
                // S·ª≠ d·ª•ng to√†n b·ªô d·ªØ li·ªáu
                rowsToPreview = currentRows.slice(START_ROW - 1, START_ROW + 4); // L·∫•y 5 d√≤ng t·ª´ START_ROW
                totalRows = Math.max(0, currentRows.length - START_ROW + 1);
            }
            
            // C·∫≠p nh·∫≠t s·ªë d√≤ng
            totalRowsElement.textContent = totalRows;
            
            // X√¢y d·ª±ng HTML preview
            let html = '';
            
            if (rowsToPreview.length === 0) {
                html = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã
                        </td>
                    </tr>
                `;
            } else {
                rowsToPreview.forEach((item, index) => {
                    const row = Array.isArray(item) ? item : item.row;
                    const rowNumber = Array.isArray(item) ? (START_ROW + index) : (item.index + 1);
                    const vatTu = parseSheetNumber(row[3]);
                    const tienCong = parseSheetNumber(row[4]);
                    const total = vatTu + tienCong;
                    
                    html += `
                        <tr>
                            <td>${rowNumber}</td>
                            <td>${row[0] || ''}</td>
                            <td>${row[1] || ''}</td>
                            <td>${row[2] || ''}</td>
                            <td>${formatCurrency(vatTu)}</td>
                            <td>${formatCurrency(tienCong)}</td>
                            <td>${formatCurrency(total)}</td>
                        </tr>
                    `;
                });
            }
            
            previewBody.innerHTML = html;
        }
        
        // Hi·ªÉn th·ªã thanh ti·∫øn tr√¨nh
        function showExportProgress() {
            const progressElement = document.getElementById('exportProgress');
            progressElement.style.display = 'block';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressText').textContent = 'ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...';
        }
        
        // C·∫≠p nh·∫≠t thanh ti·∫øn tr√¨nh
        function updateExportProgress(percent, message) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = message;
        }
        
        // ·∫®n thanh ti·∫øn tr√¨nh
        function hideExportProgress() {
            setTimeout(() => {
                document.getElementById('exportProgress').style.display = 'none';
            }, 1000);
        }
        
        // Xu·∫•t to√†n b·ªô d·ªØ li·ªáu ra Excel
        async function exportAllData() {
            try {
                showExportProgress();
                updateExportProgress(10, 'ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...');
                
                // L·∫•y d·ªØ li·ªáu hi·ªán t·∫°i
                const rows = currentRows;
                
                updateExportProgress(30, 'ƒêang t·∫°o file Excel...');
                
                // T·∫°o workbook
                const wb = XLSX.utils.book_new();
                
                // T·∫°o worksheet v·ªõi d·ªØ li·ªáu chi ti·∫øt
                const wsData = [
                    ['B√ÅO C√ÅO CHI PH√ç L√ÄM V∆Ø·ªúN', '', '', '', '', '', '', '', '', ''],
                    ['Ng√†y xu·∫•t:', new Date().toLocaleDateString('vi-VN'), '', '', '', '', '', '', '', ''],
                    ['T·ªïng s·ªë h√†ng:', rows.length - START_ROW + 1, '', '', '', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', '', '', ''],
                    ['STT', 'ID', 'Ng√†y', 'N·ªôi dung', 'Ph√≠ v·∫≠t t∆∞', 'Ti·ªÅn c√¥ng', 'Tri·ªÅu', 'T√®o', 'Thi·ªán', 'Thu·∫≠n', 'T·ªïng']
                ];
                
                // Th√™m d·ªØ li·ªáu t·ª´ START_ROW
                let rowIndex = 0;
                for (let i = START_ROW - 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row && row.length >= 5) {
                        rowIndex++;
                        const vatTu = parseSheetNumber(row[3]);
                        const tienCong = parseSheetNumber(row[4]);
                        const total = vatTu + tienCong;
                        
                        wsData.push([
                            rowIndex,
                            row[0] || '',
                            row[1] || '',
                            row[2] || '',
                            vatTu,
                            tienCong,
                            parseSheetNumber(row[6]),
                            parseSheetNumber(row[7]),
                            parseSheetNumber(row[8]),
                            parseSheetNumber(row[9]),
                            total
                        ]);
                    }
                    
                    // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh
                    if (i % 10 === 0) {
                        const progress = 30 + Math.floor((i / rows.length) * 40);
                        updateExportProgress(progress, `ƒêang x·ª≠ l√Ω d√≤ng ${i + 1}/${rows.length}...`);
                    }
                }
                
                // Th√™m t·ªïng k·∫øt
                wsData.push(['', '', '', '', '', '', '', '', '', '', '']);
                wsData.push(['T·ªîNG K·∫æT', '', '', '', '', '', '', '', '', '', '']);
                
                // T√≠nh t·ªïng
                let totalVatTu = 0, totalTienCong = 0, totalAll = 0;
                let totalTrieu = 0, totalTeo = 0, totalThien = 0, totalThuan = 0;
                
                for (let i = START_ROW - 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row && row.length >= 5) {
                        totalVatTu += parseSheetNumber(row[3]);
                        totalTienCong += parseSheetNumber(row[4]);
                        totalTrieu += parseSheetNumber(row[6]);
                        totalTeo += parseSheetNumber(row[7]);
                        totalThien += parseSheetNumber(row[8]);
                        totalThuan += parseSheetNumber(row[9]);
                    }
                }
                
                totalAll = totalVatTu + totalTienCong;
                
                wsData.push(['T·ªïng ph√≠ v·∫≠t t∆∞:', '', '', '', totalVatTu, '', '', '', '', '', '']);
                wsData.push(['T·ªïng ti·ªÅn c√¥ng:', '', '', '', '', totalTienCong, '', '', '', '', '']);
                wsData.push(['T·ªïng chi ph√≠:', '', '', '', '', '', '', '', '', '', totalAll]);
                wsData.push(['', '', '', '', '', '', '', '', '', '', '']);
                wsData.push(['Ti·ªÅn c√¥ng Tri·ªÅu:', '', '', '', '', '', totalTrieu, '', '', '', '']);
                wsData.push(['Ti·ªÅn c√¥ng T√®o:', '', '', '', '', '', '', totalTeo, '', '', '']);
                wsData.push(['Ti·ªÅn c√¥ng Thi·ªán:', '', '', '', '', '', '', '', totalThien, '', '']);
                wsData.push(['Ti·ªÅn c√¥ng Thu·∫≠n:', '', '', '', '', '', '', '', '', totalThuan, '']);
                
                updateExportProgress(80, 'ƒêang ƒë·ªãnh d·∫°ng file...');
                
                // T·∫°o worksheet
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // ƒê·ªãnh d·∫°ng c·ªôt
                const wscols = [
                    {wch: 5},  // STT
                    {wch: 10}, // ID
                    {wch: 12}, // Ng√†y
                    {wch: 40}, // N·ªôi dung
                    {wch: 15}, // Ph√≠ v·∫≠t t∆∞
                    {wch: 15}, // Ti·ªÅn c√¥ng
                    {wch: 15}, // Tri·ªÅu
                    {wch: 15}, // T√®o
                    {wch: 15}, // Thi·ªán
                    {wch: 15}, // Thu·∫≠n
                    {wch: 15}  // T·ªïng
                ];
                ws['!cols'] = wscols;
                
                // Th√™m worksheet v√†o workbook
                XLSX.utils.book_append_sheet(wb, ws, "Chi ph√≠ l√†m v∆∞·ªùn");
                
                updateExportProgress(95, 'ƒêang t·∫£i file xu·ªëng...');
                
                // Xu·∫•t file
                const fileName = `Chi_phi_lam_vuon_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                updateExportProgress(100, 'Xu·∫•t file th√†nh c√¥ng!');
                hideExportProgress();
                
                console.log(`‚úÖ ƒê√£ xu·∫•t file Excel: ${fileName}`);
                
            } catch (error) {
                console.error('L·ªói khi xu·∫•t Excel:', error);
                alert('C√≥ l·ªói x·∫£y ra khi xu·∫•t file Excel. Vui l√≤ng th·ª≠ l·∫°i.');
                hideExportProgress();
            }
        }
        
        // Xu·∫•t b√°o c√°o t·ªïng k·∫øt ra PDF
        async function exportSummaryReport() {
            try {
                showExportProgress();
                updateExportProgress(10, 'ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...');
                
                // L·∫•y d·ªØ li·ªáu hi·ªán t·∫°i
                const rows = currentRows;
                
                updateExportProgress(30, 'ƒêang t·∫°o n·ªôi dung b√°o c√°o...');
                
                // T·∫°o n·ªôi dung HTML cho PDF
                const reportDate = new Date().toLocaleDateString('vi-VN');
                const reportTime = new Date().toLocaleTimeString('vi-VN');
                
                // T√≠nh t·ªïng
                let totalVatTu = 0, totalTienCong = 0, totalAll = 0;
                let totalTrieu = 0, totalTeo = 0, totalThien = 0, totalThuan = 0;
                let dataRowsCount = 0;
                
                for (let i = START_ROW - 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row && row.length >= 5) {
                        dataRowsCount++;
                        totalVatTu += parseSheetNumber(row[3]);
                        totalTienCong += parseSheetNumber(row[4]);
                        totalTrieu += parseSheetNumber(row[6]);
                        totalTeo += parseSheetNumber(row[7]);
                        totalThien += parseSheetNumber(row[8]);
                        totalThuan += parseSheetNumber(row[9]);
                    }
                }
                
                totalAll = totalVatTu + totalTienCong;
                
                updateExportProgress(50, 'ƒêang t·∫°o PDF...');
                
                // T·∫°o PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Ti√™u ƒë·ªÅ
                doc.setFontSize(20);
                doc.setTextColor(45, 92, 42); // M√†u xanh l√° ƒë·∫≠m
                doc.text('B√ÅO C√ÅO CHI PH√ç L√ÄM V∆Ø·ªúN', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text(`Ng√†y xu·∫•t: ${reportDate} ${reportTime}`, 105, 30, { align: 'center' });
                
                // Th√¥ng tin t·ªïng qu√°t
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text('T·ªîNG QUAN CHI PH√ç', 20, 45);
                
                doc.setFontSize(11);
                doc.text(`T·ªïng s·ªë h·∫°ng m·ª•c: ${dataRowsCount}`, 20, 55);
                doc.text(`T·ªïng chi ph√≠: ${formatCurrency(totalAll)}`, 20, 62);
                doc.text(`Ph√≠ v·∫≠t t∆∞: ${formatCurrency(totalVatTu)}`, 20, 69);
                doc.text(`Ti·ªÅn c√¥ng: ${formatCurrency(totalTienCong)}`, 20, 76);
                
                // Ti·ªÅn c√¥ng theo c√¥ng nh√¢n
                doc.setFontSize(14);
                doc.text('TI·ªÄN C√îNG THEO C√îNG NH√ÇN', 20, 90);
                
                doc.setFontSize(11);
                doc.text(`Tri·ªÅu: ${formatCurrency(totalTrieu)}`, 20, 100);
                doc.text(`T√®o: ${formatCurrency(totalTeo)}`, 20, 107);
                doc.text(`Thi·ªán: ${formatCurrency(totalThien)}`, 20, 114);
                doc.text(`Thu·∫≠n: ${formatCurrency(totalThuan)}`, 20, 121);
                
                // T·ª∑ l·ªá ph·∫ßn trƒÉm
                const vatTuPercent = totalAll > 0 ? ((totalVatTu / totalAll) * 100).toFixed(1) : 0;
                const tienCongPercent = totalAll > 0 ? ((totalTienCong / totalAll) * 100).toFixed(1) : 0;
                
                // Th√™m trang th·ª© 2 v·ªõi bi·ªÉu ƒë·ªì m√¥ t·∫£
                doc.addPage();
                doc.setFontSize(16);
                doc.setTextColor(45, 92, 42);
                doc.text('PH√ÇN T√çCH CHI PH√ç', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('Ph√¢n b·ªï chi ph√≠:', 20, 40);
                
                // V·∫Ω bi·ªÉu ƒë·ªì ƒë∆°n gi·∫£n (s·ª≠ d·ª•ng h√¨nh ch·ªØ nh·∫≠t)
                const chartX = 20;
                const chartY = 50;
                const chartWidth = 170;
                const chartHeight = 20;
                
                // Ph√≠ v·∫≠t t∆∞
                doc.setFillColor(76, 175, 80);
                const vatTuWidth = (vatTuPercent / 100) * chartWidth;
                doc.rect(chartX, chartY, vatTuWidth, chartHeight, 'F');
                
                // Ti·ªÅn c√¥ng
                doc.setFillColor(33, 150, 243);
                doc.rect(chartX + vatTuWidth, chartY, chartWidth - vatTuWidth, chartHeight, 'F');
                
                // Ch√∫ th√≠ch
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Ph√≠ v·∫≠t t∆∞: ${vatTuPercent}%`, 20, 80);
                doc.text(`Ti·ªÅn c√¥ng: ${tienCongPercent}%`, 100, 80);
                
                // Th√™m th√¥ng tin h·ªá th·ªëng
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Google Sheet: ${SHEET_ID}`, 20, 150);
                doc.text(`Sheet: ${SHEET_NAME}`, 20, 157);
                doc.text(`H√†ng b·∫Øt ƒë·∫ßu: ${START_ROW}`, 20, 164);
                doc.text(`L·∫ßn c·∫≠p nh·∫≠t cu·ªëi: ${lastUpdateTime ? lastUpdateTime.toLocaleString('vi-VN') : 'N/A'}`, 20, 171);
                
                updateExportProgress(80, 'ƒêang l∆∞u file PDF...');
                
                // L∆∞u file
                const fileName = `Bao_cao_chi_phi_${new Date().toISOString().slice(0,10)}.pdf`;
                doc.save(fileName);
                
                updateExportProgress(100, 'Xu·∫•t file PDF th√†nh c√¥ng!');
                hideExportProgress();
                
                console.log(`‚úÖ ƒê√£ xu·∫•t file PDF: ${fileName}`);
                
            } catch (error) {
                console.error('L·ªói khi xu·∫•t PDF:', error);
                alert('C√≥ l·ªói x·∫£y ra khi xu·∫•t file PDF. Vui l√≤ng th·ª≠ l·∫°i.');
                hideExportProgress();
            }
        }
        
        // Xu·∫•t k·∫øt qu·∫£ t√¨m ki·∫øm
        async function exportSearchResults() {
            try {
                // Ki·ªÉm tra xem c√≥ k·∫øt qu·∫£ t√¨m ki·∫øm kh√¥ng
                const searchInput = document.getElementById('searchInput').value;
                const categoryFilter = document.getElementById('categoryFilter').value;
                const workerFilter = document.getElementById('workerFilter').value;
                const amountFilter = document.getElementById('amountFilter').value;
                
                const hasFilters = searchInput || categoryFilter || workerFilter || amountFilter;
                
                if (!hasFilters || currentFilteredRows.length === 0) {
                    alert('Kh√¥ng c√≥ k·∫øt qu·∫£ t√¨m ki·∫øm ƒë·ªÉ xu·∫•t. Vui l√≤ng s·ª≠ d·ª•ng ch·ª©c nƒÉng t√¨m ki·∫øm tr∆∞·ªõc.');
                    return;
                }
                
                showExportProgress();
                updateExportProgress(10, 'ƒêang chu·∫©n b·ªã d·ªØ li·ªáu t√¨m ki·∫øm...');
                
                updateExportProgress(30, 'ƒêang t·∫°o file Excel...');
                
                // T·∫°o workbook
                const wb = XLSX.utils.book_new();
                
                // T·∫°o worksheet v·ªõi d·ªØ li·ªáu t√¨m ki·∫øm
                const wsData = [
                    ['K·∫æT QU·∫¢ T√åM KI·∫æM CHI PH√ç L√ÄM V∆Ø·ªúN', '', '', '', '', '', '', '', '', ''],
                    ['Ng√†y xu·∫•t:', new Date().toLocaleDateString('vi-VN'), '', '', '', '', '', '', '', ''],
                    ['ƒêi·ªÅu ki·ªán t√¨m ki·∫øm:', '', '', '', '', '', '', '', '', ''],
                    ['- T·ª´ kh√≥a:', searchInput || 'Kh√¥ng c√≥', '', '', '', '', '', '', '', ''],
                    ['- Danh m·ª•c:', getCategoryFilterText(categoryFilter), '', '', '', '', '', '', '', ''],
                    ['- C√¥ng nh√¢n:', workerFilter || 'T·∫•t c·∫£', '', '', '', '', '', '', '', ''],
                    ['- M·ª©c chi ph√≠:', getAmountFilterText(amountFilter), '', '', '', '', '', '', '', ''],
                    ['T·ªïng s·ªë k·∫øt qu·∫£:', currentFilteredRows.length, '', '', '', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', '', '', ''],
                    ['STT', 'ID', 'Ng√†y', 'N·ªôi dung', 'Ph√≠ v·∫≠t t∆∞', 'Ti·ªÅn c√¥ng', 'Tri·ªÅu', 'T√®o', 'Thi·ªán', 'Thu·∫≠n', 'T·ªïng']
                ];
                
                // Th√™m d·ªØ li·ªáu t√¨m ki·∫øm
                let filteredVatTu = 0, filteredTienCong = 0, filteredTotal = 0;
                let filteredTrieu = 0, filteredTeo = 0, filteredThien = 0, filteredThuan = 0;
                
                currentFilteredRows.forEach((item, index) => {
                    const row = item.row;
                    const vatTu = parseSheetNumber(row[3]);
                    const tienCong = parseSheetNumber(row[4]);
                    const total = vatTu + tienCong;
                    
                    wsData.push([
                        index + 1,
                        row[0] || '',
                        row[1] || '',
                        row[2] || '',
                        vatTu,
                        tienCong,
                        parseSheetNumber(row[6]),
                        parseSheetNumber(row[7]),
                        parseSheetNumber(row[8]),
                        parseSheetNumber(row[9]),
                        total
                    ]);
                    
                    // T√≠nh t·ªïng
                    filteredVatTu += vatTu;
                    filteredTienCong += tienCong;
                    filteredTotal += total;
                    filteredTrieu += parseSheetNumber(row[6]);
                    filteredTeo += parseSheetNumber(row[7]);
                    filteredThien += parseSheetNumber(row[8]);
                    filteredThuan += parseSheetNumber(row[9]);
                    
                    // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh
                    if (index % 10 === 0) {
                        const progress = 30 + Math.floor((index / currentFilteredRows.length) * 40);
                        updateExportProgress(progress, `ƒêang x·ª≠ l√Ω k·∫øt qu·∫£ ${index + 1}/${currentFilteredRows.length}...`);
                    }
                });
                
                // Th√™m t·ªïng k·∫øt
                wsData.push(['', '', '', '', '', '', '', '', '', '', '']);
                wsData.push(['T·ªîNG K·∫æT K·∫æT QU·∫¢ T√åM KI·∫æM', '', '', '', '', '', '', '', '', '', '']);
                wsData.push(['T·ªïng ph√≠ v·∫≠t t∆∞:', '', '', '', filteredVatTu, '', '', '', '', '', '']);
                wsData.push(['T·ªïng ti·ªÅn c√¥ng:', '', '', '', '', filteredTienCong, '', '', '', '', '']);
                wsData.push(['T·ªïng chi ph√≠:', '', '', '', '', '', '', '', '', '', filteredTotal]);
                wsData.push(['', '', '', '', '', '', '', '', '', '', '']);
                wsData.push(['Ti·ªÅn c√¥ng Tri·ªÅu:', '', '', '', '', '', filteredTrieu, '', '', '', '']);
                wsData.push(['Ti·ªÅn c√¥ng T√®o:', '', '', '', '', '', '', filteredTeo, '', '', '']);
                wsData.push(['Ti·ªÅn c√¥ng Thi·ªán:', '', '', '', '', '', '', '', filteredThien, '', '']);
                wsData.push(['Ti·ªÅn c√¥ng Thu·∫≠n:', '', '', '', '', '', '', '', '', filteredThuan, '']);
                
                updateExportProgress(80, 'ƒêang ƒë·ªãnh d·∫°ng file...');
                
                // T·∫°o worksheet
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // ƒê·ªãnh d·∫°ng c·ªôt
                const wscols = [
                    {wch: 5},  // STT
                    {wch: 10}, // ID
                    {wch: 12}, // Ng√†y
                    {wch: 40}, // N·ªôi dung
                    {wch: 15}, // Ph√≠ v·∫≠t t∆∞
                    {wch: 15}, // Ti·ªÅn c√¥ng
                    {wch: 15}, // Tri·ªÅu
                    {wch: 15}, // T√®o
                    {wch: 15}, // Thi·ªán
                    {wch: 15}, // Thu·∫≠n
                    {wch: 15}  // T·ªïng
                ];
                ws['!cols'] = wscols;
                
                // Th√™m worksheet v√†o workbook
                XLSX.utils.book_append_sheet(wb, ws, "K·∫øt qu·∫£ t√¨m ki·∫øm");
                
                updateExportProgress(95, 'ƒêang t·∫£i file xu·ªëng...');
                
                // Xu·∫•t file
                const fileName = `Ket_qua_tim_kiem_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                updateExportProgress(100, 'Xu·∫•t file th√†nh c√¥ng!');
                hideExportProgress();
                
                console.log(`‚úÖ ƒê√£ xu·∫•t k·∫øt qu·∫£ t√¨m ki·∫øm: ${fileName}`);
                
            } catch (error) {
                console.error('L·ªói khi xu·∫•t k·∫øt qu·∫£ t√¨m ki·∫øm:', error);
                alert('C√≥ l·ªói x·∫£y ra khi xu·∫•t k·∫øt qu·∫£ t√¨m ki·∫øm. Vui l√≤ng th·ª≠ l·∫°i.');
                hideExportProgress();
            }
        }
        
        // H√†m h·ªó tr·ª£ ƒë·ªÉ l·∫•y t√™n b·ªô l·ªçc
        function getCategoryFilterText(value) {
            switch(value) {
                case 'vat_tu': return 'Ph√≠ v·∫≠t t∆∞';
                case 'tien_cong': return 'Ti·ªÅn c√¥ng';
                default: return 'T·∫•t c·∫£';
            }
        }
        
        function getAmountFilterText(value) {
            switch(value) {
                case '0-500000': return 'D∆∞·ªõi 500,000 ‚Ç´';
                case '500000-1000000': return '500,000 - 1,000,000 ‚Ç´';
                case '1000000-5000000': return '1,000,000 - 5,000,000 ‚Ç´';
                case '5000000+': return 'Tr√™n 5,000,000 ‚Ç´';
                default: return 'M·ªçi m·ª©c chi ph√≠';
            }
        }
        
        // ============================
        // KH·ªûI CH·∫†Y H·ªÜ TH·ªêNG
        // ============================
        window.onload = initSystem;
        
        // Cho ph√©p refresh th·ªß c√¥ng b·∫±ng ph√≠m F5
        document.addEventListener('keydown', function(event) {
            if (event.key === 'F5') {
                event.preventDefault();
                loadData();
            }
        });
    </script>
</body>
</html>
