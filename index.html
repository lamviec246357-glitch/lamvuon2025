<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ph√≠ l√†m v∆∞·ªùn</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7f0;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 4px solid #4CAF50;
        }
        
        h1 {
            color: #2d5c2a;
            margin-bottom: 15px;
            font-size: 2.5em;
        }
        
        .success-banner {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .success-banner h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .card {
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 2px solid #4CAF50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: #2d5c2a;
            margin-bottom: 20px;
            font-size: 1.3em;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .amount {
            font-size: 2.2em;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .note {
            color: #777;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .button-container {
            text-align: center;
            margin: 40px 0;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        button:hover {
            background-color: #3d8b40;
            transform: scale(1.05);
        }
        
        .instructions {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin-top: 40px;
            border-left: 5px solid #4CAF50;
        }
        
        .instructions h3 {
            color: #2d5c2a;
            margin-bottom: 15px;
        }
        
        .instructions ol {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        .instructions li {
            margin-bottom: 10px;
            padding-left: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 25px;
            border-top: 2px solid #eee;
            color: #777;
            font-size: 0.95em;
        }
        
        .url-display {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            word-break: break-all;
            border: 1px solid #4CAF50;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .amount {
                font-size: 1.8em;
            }
            
            h1 {
                font-size: 2em;
            }
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåø CHI PH√ç L√ÄM V∆Ø·ªúN üéâ</h1>
            <p>Th·ªëng k√™ chi ph√≠ l√†m v∆∞·ªùn t·ª± ƒë·ªông t·ª´ Google Sheet</p>
        </header>
        
        <div class="success-banner">
            <h2>‚úÖ TH√ÄNH C√îNG!</h2>
            <p>Trang web c·ªßa b·∫°n ƒë√£ ho·∫°t ƒë·ªông tr√™n GitHub Pages!</p>
            <p><strong>URL:</strong> <span id="currentUrl"></span></p>
        </div>
        
        <div class="summary-grid">
            <div class="card">
                <h3>üí∞ T·ªïng chi ph√≠ l√†m v∆∞·ªùn</h3>
                <div class="amount" id="totalChiPhi">0 ‚Ç´</div>
                <div class="note">D = Ph√≠ v·∫≠t t∆∞ + E = Ti·ªÅn c√¥ng</div>
            </div>
            
            <div class="card">
                <h3>üõ†Ô∏è T·ªïng ph√≠ v·∫≠t t∆∞</h3>
                <div class="amount" id="totalVatTu">0 ‚Ç´</div>
                <div class="note">C·ªôt D trong Google Sheet</div>
            </div>
            
            <div class="card">
                <h3>üë∑ T·ªïng ti·ªÅn c√¥ng</h3>
                <div class="amount" id="totalTienCong">0 ‚Ç´</div>
                <div class="note">C·ªôt E trong Google Sheet</div>
            </div>
            
            <div class="card">
                <h3>üë® Tri·ªÅu</h3>
                <div class="amount" id="totalTrieu">0 ‚Ç´</div>
                <div class="note">C·ªôt G trong Google Sheet</div>
            </div>
            
            <div class="card">
                <h3>üë® T√®o</h3>
                <div class="amount" id="totalTeo">0 ‚Ç´</div>
                <div class="note">C·ªôt H trong Google Sheet</div>
            </div>
            
            <div class="card">
                <h3>üë® Thi·ªán</h3>
                <div class="amount" id="totalThien">0 ‚Ç´</div>
                <div class="note">C·ªôt I trong Google Sheet</div>
            </div>
            
            <div class="card">
                <h3>üë® Thu√¢n</h3>
                <div class="amount" id="totalThuan">0 ‚Ç´</div>
                <div class="note">C·ªôt J trong Google Sheet</div>
            </div>
        </div>
        
        <div class="button-container">
            <button onclick="showDetail()">üìã Xem chi ti·∫øt</button>
        </div>
        
        <div id="detailSection" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 25px; color: #2d5c2a;">Chi ti·∫øt c√°c kho·∫£n chi</h2>
            <div class="loading" id="loadingDetail">
                ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet...
                <p style="margin-top: 10px; font-size: 0.9em;">
                    C·∫ßn c·∫•u h√¨nh Google Sheet ID ƒë·ªÉ xem d·ªØ li·ªáu th·ª±c
                </p>
            </div>
            <div id="detailContent"></div>
            <div class="button-container">
                <button onclick="hideDetail()" style="background-color: #666;">ƒê√≥ng chi ti·∫øt</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>üìù H∆∞·ªõng d·∫´n c·∫•u h√¨nh Google Sheet:</h3>
            <ol>
                <li>M·ªü Google Sheet "Chi phi lam vuon"</li>
                <li>Copy ID t·ª´ URL (ph·∫ßn gi·ªØa /d/ v√† /edit)</li>
                <li>Quay l·∫°i file n√†y, t√¨m d√≤ng <code>const SHEET_ID = ''</code></li>
                <li>D√°n ID v√†o gi·ªØa d·∫•u nh√°y ƒë∆°n: <code>const SHEET_ID = 'ID_CUA_BAN'</code></li>
                <li>Click "Commit changes" ƒë·ªÉ l∆∞u</li>
                <li>Refresh trang web sau 1 ph√∫t</li>
            </ol>
            
            <div class="url-display">
                <strong>URL trang web c·ªßa b·∫°n:</strong><br>
                https://lamviec246357-glitch.github.io/lamvuon2025/
            </div>
        </div>
        
        <footer>
            <p>Trang web chi ph√≠ l√†m v∆∞·ªùn - T·ª± ƒë·ªông c·∫≠p nh·∫≠t t·ª´ Google Sheet</p>
            <p>¬© 2025 - C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <span id="lastUpdate">ƒêang t·∫£i...</span></p>
        </footer>
    </div>

    <script>
        // ============================
        // C·∫§U H√åNH QUAN TR·ªåNG - THAY ƒê·ªîI ·ªû ƒê√ÇY
        // ============================
        
        // THAY ƒê·ªîI ID N√ÄY B·∫∞NG ID C·ª¶A SHEET C·ª¶A B·∫†N
        const SHEET_ID = '';
        const SHEET_NAME = 'SR2526';
        
        // ============================
        // H√ÄM HI·ªÇN TH·ªä
        // ============================
        
        // Hi·ªÉn th·ªã URL hi·ªán t·∫°i
        document.getElementById('currentUrl').textContent = window.location.href;
        
        // ƒê·ªãnh d·∫°ng ti·ªÅn Vi·ªát Nam
        function formatCurrency(value) {
            if (!value && value !== 0) return '0 ‚Ç´';
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(value);
        }
        
        // Hi·ªÉn th·ªã/·∫©n chi ti·∫øt
        function showDetail() {
            if (!SHEET_ID) {
                alert('‚ö†Ô∏è Vui l√≤ng c·∫•u h√¨nh Google Sheet ID tr∆∞·ªõc!\n\nXem h∆∞·ªõng d·∫´n trong ph·∫ßn "H∆∞·ªõng d·∫´n c·∫•u h√¨nh Google Sheet"');
                return;
            }
            document.getElementById('detailSection').style.display = 'block';
            loadDetailData();
        }
        
        function hideDetail() {
            document.getElementById('detailSection').style.display = 'none';
        }
        
        // T·∫£i d·ªØ li·ªáu chi ti·∫øt
        async function loadDetailData() {
            if (!SHEET_ID) {
                document.getElementById('detailContent').innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #d32f2f;">
                        <h3>Ch∆∞a c·∫•u h√¨nh Google Sheet ID</h3>
                        <p>Vui l√≤ng th√™m ID Google Sheet v√†o m√£ ngu·ªìn</p>
                    </div>
                `;
                return;
            }
            
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                // X·ª≠ l√Ω d·ªØ li·ªáu CSV
                const rows = parseCSV(csvText);
                
                if (rows.length < 3) {
                    document.getElementById('detailContent').innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #d32f2f;">
                            <h3>Kh√¥ng c√≥ d·ªØ li·ªáu</h3>
                            <p>Google Sheet kh√¥ng c√≥ d·ªØ li·ªáu ho·∫∑c Sheet name kh√¥ng ƒë√∫ng</p>
                        </div>
                    `;
                    return;
                }
                
                // T√≠nh to√°n t·ªïng v√† hi·ªÉn th·ªã
                calculateAndDisplayTotals(rows);
                displayDetailTable(rows);
                
                // C·∫≠p nh·∫≠t th·ªùi gian
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('vi-VN');
                
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                document.getElementById('detailContent').innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #d32f2f;">
                        <h3>L·ªói khi t·∫£i d·ªØ li·ªáu</h3>
                        <p>Vui l√≤ng ki·ªÉm tra:</p>
                        <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                            <li>Google Sheet ID c√≥ ƒë√∫ng kh√¥ng</li>
                            <li>Sheet ƒë√£ chia s·∫ª public ch∆∞a</li>
                            <li>Sheet name c√≥ ƒë√∫ng "SR2526" kh√¥ng</li>
                        </ul>
                    </div>
                `;
            }
            
            document.getElementById('loadingDetail').style.display = 'none';
        }
        
        // Ph√¢n t√≠ch CSV
        function parseCSV(csvText) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentField);
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentRow.push(currentField);
                    rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            
            if (currentField || currentRow.length > 0) {
                currentRow.push(currentField);
                rows.push(currentRow);
            }
            
            return rows;
        }
        
        // T√≠nh to√°n v√† hi·ªÉn th·ªã t·ªïng
        function calculateAndDisplayTotals(rows) {
            let totalVatTu = 0, totalTienCong = 0, totalTrieu = 0, totalTeo = 0, totalThien = 0, totalThuan = 0;
            
            // B·∫Øt ƒë·∫ßu t·ª´ h√†ng 3 (index 2) v√¨ h√†ng 1-2 l√† ti√™u ƒë·ªÅ
            for (let i = 2; i < rows.length; i++) {
                const row = rows[i];
                totalVatTu += parseFloat(row[3] || 0);
                totalTienCong += parseFloat(row[4] || 0);
                totalTrieu += parseFloat(row[6] || 0);
                totalTeo += parseFloat(row[7] || 0);
                totalThien += parseFloat(row[8] || 0);
                totalThuan += parseFloat(row[9] || 0);
            }
            
            const totalChiPhi = totalVatTu + totalTienCong;
            
            // C·∫≠p nh·∫≠t giao di·ªán
            document.getElementById('totalChiPhi').textContent = formatCurrency(totalChiPhi);
            document.getElementById('totalVatTu').textContent = formatCurrency(totalVatTu);
            document.getElementById('totalTienCong').textContent = formatCurrency(totalTienCong);
            document.getElementById('totalTrieu').textContent = formatCurrency(totalTrieu);
            document.getElementById('totalTeo').textContent = formatCurrency(totalTeo);
            document.getElementById('totalThien').textContent = formatCurrency(totalThien);
            document.getElementById('totalThuan').textContent = formatCurrency(totalThuan);
        }
        
        // Hi·ªÉn th·ªã b·∫£ng chi ti·∫øt
        function displayDetailTable(rows) {
            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background-color: #4CAF50; color: white;">
                                <th style="padding: 15px; text-align: left;">ID</th>
                                <th style="padding: 15px; text-align: left;">Ng√†y</th>
                                <th style="padding: 15px; text-align: left;">N·ªôi dung</th>
                                <th style="padding: 15px; text-align: left;">Ph√≠ v·∫≠t t∆∞</th>
                                <th style="padding: 15px; text-align: left;">Ti·ªÅn c√¥ng</th>
                                <th style="padding: 15px; text-align: left;">Tri·ªÅu</th>
                                <th style="padding: 15px; text-align: left;">T√®o</th>
                                <th style="padding: 15px; text-align: left;">Thi·ªán</th>
                                <th style="padding: 15px; text-align: left;">Thu√¢n</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // B·∫Øt ƒë·∫ßu t·ª´ h√†ng 3
            for (let i = 2; i < Math.min(rows.length, 52); i++) { // Hi·ªÉn th·ªã t·ªëi ƒëa 50 d√≤ng
                const row = rows[i];
                html += `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 12px 15px;">${row[0] || ''}</td>
                        <td style="padding: 12px 15px;">${row[1] || ''}</td>
                        <td style="padding: 12px 15px;">${row[2] || ''}</td>
                        <td style="padding: 12px 15px;">${formatCurrency(row[3] || 0)}</td>
                        <td style="padding: 12px 15px;">${formatCurrency(row[4] || 0)}</td>
                        <td style="padding: 12px 15px;">${formatCurrency(row[6] || 0)}</td>
                        <td style="padding: 12px 15px;">${formatCurrency(row[7] || 0)}</td>
                        <td style="padding: 12px 15px;">${formatCurrency(row[8] || 0)}</td>
                        <td style="padding: 12px 15px;">${formatCurrency(row[9] || 0)}</td>
                    </tr>
                `;
            }
            
            html += `
                        </tbody>
                    </table>
                    <p style="margin-top: 20px; color: #666;">
                        <strong>T·ªïng s·ªë b·∫£n ghi:</strong> ${Math.max(0, rows.length - 2)} d√≤ng d·ªØ li·ªáu
                    </p>
                </div>
            `;
            
            document.getElementById('detailContent').innerHTML = html;
        }
        
        // T·ª± ƒë·ªông c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªói 5 ph√∫t
        if (SHEET_ID) {
            setInterval(loadDetailData, 5 * 60 * 1000);
        }
        
        // Ki·ªÉm tra khi trang ƒë∆∞·ª£c t·∫£i
        window.onload = function() {
            if (!SHEET_ID) {
                setTimeout(() => {
                    alert('‚ö†Ô∏è QUAN TR·ªåNG: Ch∆∞a c·∫•u h√¨nh Google Sheet ID!\n\nVui l√≤ng th√™m ID Google Sheet v√†o m√£ ngu·ªìn ƒë·ªÉ hi·ªÉn th·ªã d·ªØ li·ªáu th·ª±c.');
                }, 1000);
            } else {
                // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu n·∫øu ƒë√£ c·∫•u h√¨nh
                loadDetailData();
            }
        };
    </script>
</body>
</html>
