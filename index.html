<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ph√≠ l√†m v∆∞·ªùn</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7f0;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 4px solid #4CAF50;
        }
        
        h1 {
            color: #2d5c2a;
            margin-bottom: 15px;
            font-size: 2.5em;
        }
        
        .success-banner {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .success-banner h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .card {
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 2px solid #4CAF50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: #2d5c2a;
            margin-bottom: 20px;
            font-size: 1.3em;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .amount {
            font-size: 2.2em;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .note {
            color: #777;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .button-container {
            text-align: center;
            margin: 40px 0;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        button:hover {
            background-color: #3d8b40;
            transform: scale(1.05);
        }
        
        .instructions {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin-top: 40px;
            border-left: 5px solid #4CAF50;
        }
        
        .instructions h3 {
            color: #2d5c2a;
            margin-bottom: 15px;
        }
        
        .instructions ol {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        .instructions li {
            margin-bottom: 10px;
            padding-left: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 25px;
            border-top: 2px solid #eee;
            color: #777;
            font-size: 0.95em;
        }
        
        .url-display {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            word-break: break-all;
            border: 1px solid #4CAF50;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .amount {
                font-size: 1.8em;
            }
            
            h1 {
                font-size: 2em;
            }
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: left;
        }
        
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .data-success {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #4CAF50;
        }
        
        .info-box {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 5px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåø CHI PH√ç L√ÄM V∆Ø·ªúN üéâ</h1>
            <p>Th·ªëng k√™ chi ph√≠ l√†m v∆∞·ªùn t·ª± ƒë·ªông t·ª´ Google Sheet</p>
        </header>
        
        <div class="success-banner">
            <h2>‚úÖ K·∫æT N·ªêI TH√ÄNH C√îNG!</h2>
            <p>Trang web ƒë√£ ƒë∆∞·ª£c k·∫øt n·ªëi v·ªõi Google Sheet c·ªßa b·∫°n!</p>
            <p><strong>URL:</strong> <span id="currentUrl"></span></p>
        </div>
        
        <div class="info-box">
            <p><strong>üìå L∆∞u √Ω:</strong> D·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª´ <strong>h√†ng 2</strong> trong Google Sheet (c√°c √¥ t·ªïng c·ªông)</p>
        </div>
        
        <div id="summary" class="summary-grid">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c t·∫£i t·ª± ƒë·ªông -->
            <div class="card">
                <h3>üí∞ T·ªïng chi ph√≠ l√†m v∆∞·ªùn</h3>
                <div class="amount" id="totalChiPhi">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>C2</strong></div>
            </div>
            
            <div class="card">
                <h3>üõ†Ô∏è T·ªïng ph√≠ v·∫≠t t∆∞</h3>
                <div class="amount" id="totalVatTu">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>D2</strong></div>
            </div>
            
            <div class="card">
                <h3>üë∑ T·ªïng ti·ªÅn c√¥ng</h3>
                <div class="amount" id="totalTienCong">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>E2</strong></div>
            </div>
            
            <div class="card">
                <h3>üë® Tri·ªÅu</h3>
                <div class="amount" id="totalTrieu">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>G2</strong></div>
            </div>
            
            <div class="card">
                <h3>üë® T√®o</h3>
                <div class="amount" id="totalTeo">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>H2</strong></div>
            </div>
            
            <div class="card">
                <h3>üë® Thi·ªán</h3>
                <div class="amount" id="totalThien">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>I2</strong></div>
            </div>
            
            <div class="card">
                <h3>üë® Thu·∫≠n</h3>
                <div class="amount" id="totalThuan">ƒêang t·∫£i...</div>
                <div class="note">Gi√° tr·ªã t·ª´ √¥ <strong>J2</strong></div>
            </div>
        </div>
        
        <div class="button-container">
            <button onclick="showDetail()">üìã Xem chi ti·∫øt</button>
        </div>
        
        <div id="detailSection" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 25px; color: #2d5c2a;">Chi ti·∫øt c√°c kho·∫£n chi</h2>
            <div class="loading" id="loadingDetail">
                ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet...
            </div>
            <div id="detailContent"></div>
            <div class="button-container">
                <button onclick="hideDetail()" style="background-color: #666;">ƒê√≥ng chi ti·∫øt</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>üìä Th√¥ng tin k·∫øt n·ªëi:</h3>
            <div class="data-success">
                <p><strong>‚úÖ Google Sheet ID:</strong> 1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4</p>
                <p><strong>‚úÖ Sheet name:</strong> SR2526</p>
                <p><strong>‚úÖ L·∫•y gi√° tr·ªã t·ª´:</strong> H√†ng 2 (C2, D2, E2, G2, H2, I2, J2)</p>
                <p><strong>‚úÖ T·ª± ƒë·ªông c·∫≠p nh·∫≠t:</strong> M·ªói 5 ph√∫t</p>
            </div>
            
            <div class="url-display">
                <strong>üåê URL trang web c·ªßa b·∫°n:</strong><br>
                https://lamviec246357-glitch.github.io/lamvuon2025/
            </div>
            
            <h3 style="margin-top: 25px;">üìù L∆∞u √Ω quan tr·ªçng:</h3>
            <ol>
                <li>Google Sheet ph·∫£i ƒë∆∞·ª£c chia s·∫ª <strong>public</strong> (View cho m·ªçi ng∆∞·ªùi)</li>
                <li>ƒê·∫£m b·∫£o h√†ng 2 c√≥ c√°c gi√° tr·ªã t·ªïng c·ªông</li>
                <li>D·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t khi b·∫°n s·ª≠a Google Sheet</li>
                <li>Refresh trang web ƒë·ªÉ xem d·ªØ li·ªáu m·ªõi nh·∫•t</li>
            </ol>
        </div>
        
        <footer>
            <p>Trang web chi ph√≠ l√†m v∆∞·ªùn - T·ª± ƒë·ªông c·∫≠p nh·∫≠t t·ª´ Google Sheet</p>
            <p>¬© 2025 - C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <span id="lastUpdate">ƒêang t·∫£i...</span></p>
            <p style="margin-top: 10px; font-size: 0.85em; color: #999;">
                Sheet ID: 1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4
            </p>
        </footer>
    </div>

    <script>
        // ============================
        // C·∫§U H√åNH GOOGLE SHEET
        // ============================
        const SHEET_ID = '1bVQzzwKmtqMwuCPUX0TJx9Fnsdbkuk57ncnX4HXU5v4';
        const SHEET_NAME = 'SR2526';
        
        // ============================
        // H√ÄM HI·ªÇN TH·ªä
        // ============================
        
        // Hi·ªÉn th·ªã URL hi·ªán t·∫°i
        document.getElementById('currentUrl').textContent = window.location.href;
        
        // ƒê·ªãnh d·∫°ng ti·ªÅn Vi·ªát Nam
        function formatCurrency(value) {
            if (value === null || value === undefined || value === '' || isNaN(value)) return '0 ‚Ç´';
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(parseFloat(value));
        }
        
        // Hi·ªÉn th·ªã/·∫©n chi ti·∫øt
        function showDetail() {
            document.getElementById('detailSection').style.display = 'block';
            loadDetailData();
        }
        
        function hideDetail() {
            document.getElementById('detailSection').style.display = 'none';
        }
        
        // T·∫£i d·ªØ li·ªáu chi ti·∫øt
        async function loadDetailData() {
            try {
                // Hi·ªÉn th·ªã loading
                document.getElementById('loadingDetail').style.display = 'block';
                document.getElementById('detailContent').innerHTML = '';
                
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`L·ªói HTTP: ${response.status}`);
                }
                
                const csvText = await response.text();
                
                // X·ª≠ l√Ω d·ªØ li·ªáu CSV
                const rows = parseCSV(csvText);
                
                if (rows.length < 2) {
                    showError('Google Sheet kh√¥ng c√≥ ƒë·ªß d·ªØ li·ªáu');
                    return;
                }
                
                // L·∫§Y GI√Å TR·ªä T·ª™ H√ÄNG 2 (index 1)
                // H√†ng 1 (index 0): Ti√™u ƒë·ªÅ c·ªôt
                // H√†ng 2 (index 1): Gi√° tr·ªã t·ªïng c·ªông
                const row2 = rows[1]; // H√†ng th·ª© 2 (index 1)
                
                // C2 = c·ªôt 2 (index 2), D2 = c·ªôt 3 (index 3), E2 = c·ªôt 4 (index 4)
                // G2 = c·ªôt 6 (index 6), H2 = c·ªôt 7 (index 7), I2 = c·ªôt 8 (index 8), J2 = c·ªôt 9 (index 9)
                
                // Hi·ªÉn th·ªã gi√° tr·ªã t·ª´ h√†ng 2
                displayRow2Values(row2);
                
                // Hi·ªÉn th·ªã b·∫£ng chi ti·∫øt (t·ª´ h√†ng 3 tr·ªü ƒëi)
                displayDetailTable(rows);
                
                // C·∫≠p nh·∫≠t th·ªùi gian
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('vi-VN');
                
                // ·∫®n loading
                document.getElementById('loadingDetail').style.display = 'none';
                
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                showError(`Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet. Vui l√≤ng ki·ªÉm tra:<br>
                    1. Google Sheet ƒë√£ chia s·∫ª public ch∆∞a?<br>
                    2. Sheet name c√≥ ƒë√∫ng "SR2526" kh√¥ng?<br>
                    3. K·∫øt n·ªëi internet c·ªßa b·∫°n`);
            }
        }
        
        // Hi·ªÉn th·ªã gi√° tr·ªã t·ª´ h√†ng 2
        function displayRow2Values(row) {
            // Ki·ªÉm tra n·∫øu row c√≥ ƒë·ªß ph·∫ßn t·ª≠
            if (!row || row.length < 10) {
                console.error('H√†ng 2 kh√¥ng c√≥ ƒë·ªß d·ªØ li·ªáu:', row);
                return;
            }
            
            // L·∫•y gi√° tr·ªã t·ª´ c√°c c·ªôt (0-based index)
            // C2 = c·ªôt C (index 2)
            // D2 = c·ªôt D (index 3) 
            // E2 = c·ªôt E (index 4)
            // G2 = c·ªôt G (index 6)
            // H2 = c·ªôt H (index 7)
            // I2 = c·ªôt I (index 8)
            // J2 = c·ªôt J (index 9)
            
            const c2Value = row[2] || '0';  // C2
            const d2Value = row[3] || '0';  // D2
            const e2Value = row[4] || '0';  // E2
            const g2Value = row[6] || '0';  // G2
            const h2Value = row[7] || '0';  // H2
            const i2Value = row[8] || '0';  // I2
            const j2Value = row[9] || '0';  // J2
            
            // Hi·ªÉn th·ªã l√™n giao di·ªán
            document.getElementById('totalChiPhi').textContent = formatCurrency(c2Value);
            document.getElementById('totalVatTu').textContent = formatCurrency(d2Value);
            document.getElementById('totalTienCong').textContent = formatCurrency(e2Value);
            document.getElementById('totalTrieu').textContent = formatCurrency(g2Value);
            document.getElementById('totalTeo').textContent = formatCurrency(h2Value);
            document.getElementById('totalThien').textContent = formatCurrency(i2Value);
            document.getElementById('totalThuan').textContent = formatCurrency(j2Value);
            
            // Log ƒë·ªÉ debug
            console.log('D·ªØ li·ªáu t·ª´ h√†ng 2:', {
                'C2 (T·ªïng chi ph√≠)': c2Value,
                'D2 (Ph√≠ v·∫≠t t∆∞)': d2Value,
                'E2 (Ti·ªÅn c√¥ng)': e2Value,
                'G2 (Tri·ªÅu)': g2Value,
                'H2 (T√®o)': h2Value,
                'I2 (Thi·ªán)': i2Value,
                'J2 (Thu·∫≠n)': j2Value
            });
        }
        
        // Hi·ªÉn th·ªã l·ªói
        function showError(message) {
            document.getElementById('loadingDetail').style.display = 'none';
            document.getElementById('detailContent').innerHTML = `
                <div style="text-align: center; padding: 30px; color: #d32f2f; background: #ffebee; border-radius: 8px;">
                    <h3>‚ùå L·ªói k·∫øt n·ªëi</h3>
                    <p>${message}</p>
                    <button onclick="loadDetailData()" style="margin-top: 15px; padding: 10px 20px; background: #d32f2f; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Th·ª≠ l·∫°i
                    </button>
                </div>
            `;
        }
        
        // Ph√¢n t√≠ch CSV
        function parseCSV(csvText) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentRow.push(currentField.trim());
                    rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                } else if (char === '\r') {
                    // B·ªè qua k√Ω t·ª± carriage return
                    continue;
                } else {
                    currentField += char;
                }
            }
            
            // Th√™m d√≤ng cu·ªëi c√πng
            if (currentField.trim() || currentRow.length > 0) {
                currentRow.push(currentField.trim());
                rows.push(currentRow);
            }
            
            return rows;
        }
        
        // Hi·ªÉn th·ªã b·∫£ng chi ti·∫øt (t·ª´ h√†ng 3 tr·ªü ƒëi)
        function displayDetailTable(rows) {
            let html = `
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ng√†y</th>
                                <th>N·ªôi dung</th>
                                <th>Ph√≠ v·∫≠t t∆∞</th>
                                <th>Ti·ªÅn c√¥ng</th>
                                <th>Tri·ªÅu</th>
                                <th>T√®o</th>
                                <th>Thi·ªán</th>
                                <th>Thu·∫≠n</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // B·∫Øt ƒë·∫ßu t·ª´ h√†ng 3 (index 2) - b·ªè 2 h√†ng ƒë·∫ßu
            let dataCount = 0;
            for (let i = 2; i < rows.length; i++) {
                const row = rows[i];
                if (row.length < 10) continue; // B·ªè qua h√†ng kh√¥ng ƒë·ªß c·ªôt
                
                html += `
                    <tr>
                        <td>${row[0] || ''}</td>
                        <td>${row[1] || ''}</td>
                        <td>${row[2] || ''}</td>
                        <td>${formatCurrency(row[3] || 0)}</td>
                        <td>${formatCurrency(row[4] || 0)}</td>
                        <td>${formatCurrency(row[6] || 0)}</td>
                        <td>${formatCurrency(row[7] || 0)}</td>
                        <td>${formatCurrency(row[8] || 0)}</td>
                        <td>${formatCurrency(row[9] || 0)}</td>
                    </tr>
                `;
                dataCount++;
            }
            
            html += `
                        </tbody>
                    </table>
                    <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                        <p><strong>üìä T·ªïng s·ªë b·∫£n ghi chi ti·∫øt:</strong> ${dataCount} d√≤ng d·ªØ li·ªáu (t·ª´ h√†ng 3)</p>
                        <p><strong>üìà Gi√° tr·ªã t·ªïng l·∫•y t·ª´:</strong> H√†ng 2 (C2, D2, E2, G2, H2, I2, J2)</p>
                        <p><strong>üîÑ T·ª± ƒë·ªông c·∫≠p nh·∫≠t:</strong> M·ªói 5 ph√∫t</p>
                    </div>
                </div>
            `;
            
            document.getElementById('detailContent').innerHTML = html;
        }
        
        // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu khi trang ƒë∆∞·ª£c m·ªü
        window.onload = function() {
            // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu
            loadDetailData();
            
            // T·ª± ƒë·ªông c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªói 5 ph√∫t
            setInterval(loadDetailData, 5 * 60 * 1000);
        };
    </script>
</body>
</html>
